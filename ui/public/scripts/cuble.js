(()=>{var wt=[1,1,1,1],yt=[.5,.5,.5,1],Kt=[1,1,0,1];var Gt=[0,1,0,1];var Wt=[0,0,1,1];var jt=[1,.5,0,1];var Yt=[1,0,0,1];var pt=[0,0,0,1],mt=[wt,Gt,Kt,Wt,jt,Yt];function Q(r){return(r<0||r>=mt.length)&&console.error("Invalid face: "+r),mt[r]}var tt=[4,13,22,31,40,49],Nt=[0,29,36],Qt=[6,35,51],zt=[2,9,42],Vt=[8,15,45],Xt=[18,11,44],$t=[24,47,17],Jt=[20,38,27],Zt=[26,33,53],te=[3,32],ee=[1,39],re=[7,48],ne=[5,12],se=[10,43],ie=[16,46],oe=[21,14],ae=[19,41],le=[25,50],ce=[23,30],ue=[28,37],fe=[34,52],he=[...Nt,...Qt,...zt,...Vt],me=[...Xt,...$t,...Jt,...Zt],ye=[...te,...ee,...re,...ne],pe=[...se,...ie,...ue,...fe],de=[...oe,...ae,...le,...ce],Se=[...tt,...ye],xe=[...Se,...he],be=[...xe,...pe],ke=[...de,...me],Ve=[...be,...ke];function St(r,e,t){let n=et(e,1.01,.02),s=et(e,1,0),i=et(e,1.5,.02),l=Array(e.numOfStickers);for(let o=0;o<e.numOfStickers;o++){let a={positionBuffer:r.createBuffer(),noGapPositionBuffer:r.createBuffer(),hintPositionBuffer:r.createBuffer(),indexBuffer:r.createBuffer(),cart2d:[],positions:null},u=new Float32Array(12),f=new Float32Array(12),h=new Float32Array(12);for(let c=0;c<12;c++){let p=o*12+c;u[c]=n[p],f[c]=s[p],h[c]=i[p]}if(r.bindBuffer(r.ARRAY_BUFFER,a.positionBuffer),r.bufferData(r.ARRAY_BUFFER,u,r.STATIC_DRAW),a.positions=u,r.bindBuffer(r.ARRAY_BUFFER,a.noGapPositionBuffer),r.bufferData(r.ARRAY_BUFFER,f,r.STATIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,a.hintPositionBuffer),r.bufferData(r.ARRAY_BUFFER,h,r.STATIC_DRAW),t){let c=Array(16);z(c,0,t,[f[0],f[1],f[2],1]),z(c,4,t,[f[3],f[4],f[5],1]),z(c,8,t,[f[6],f[7],f[8],1]),z(c,12,t,[f[9],f[10],f[11],1]),a.cart2d=[c[0]/c[3],c[1]/c[3],c[4]/c[7],c[5]/c[7],c[8]/c[11],c[9]/c[11],c[12]/c[15],c[13]/c[15]]}let m=[0,1,2,0,2,3];r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,a.indexBuffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,new Uint16Array(m),r.STATIC_DRAW),l[o]=a}return l}function z(r,e,t,n){let s=Array(4),i=n[0],l=n[1],o=n[2],a=n[3];r[e+0]=i*t[0]+l*t[4]+o*t[8]+a*t[12],r[e+1]=i*t[1]+l*t[5]+o*t[9]+a*t[13],r[e+2]=i*t[2]+l*t[6]+o*t[10]+a*t[14],r[e+3]=i*t[3]+l*t[7]+o*t[11]+a*t[15]}var xt=12,Le=4,j=3;function et(r,e,t){let n=r.layersSq*xt,s=Array(6*n);return Ae(s,0*n,r,1,e,t),Re(s,1*n,r,0,e,t),Te(s,2*n,r,1,-e,t),Ee(s,3*n,r,0,-e,t),Oe(s,4*n,r,2,-e,t),ve(s,5*n,r,2,e,t),s}function Ae(r,e,t,n,s,i){if(t.layersEven){let a=Array(t.layersSq),u=0;for(let f=0;f<t.layers;f++)for(let h=0;h<t.layers;h++){let m=-1+1/t.layers+h*2/t.layers,c=-1+1/t.layers+f*2/t.layers;a[u]=[m,c,s],u++}k(r,e,t,a,n,i);return}let l=Array(t.layersSq),o=0;for(let a=-t.layersHalf;a<=t.layersHalf;a++)for(let u=-t.layersHalf;u<=t.layersHalf;u++)l[o]=[2*u/t.layers,2*a/t.layers,s],o++;k(r,e,t,l,n,i)}function Re(r,e,t,n,s,i){if(t.layersEven){let a=Array(t.layersSq),u=0;for(let f=0;f<t.layers;f++)for(let h=t.layers-1;h>=0;h--){let m=-1+1/t.layers+f*2/t.layers,c=-1+1/t.layers+h*2/t.layers;a[u]=[m,c,s],u++}k(r,e,t,a,n,i);return}let l=Array(t.layersSq),o=0;for(let a=-t.layersHalf;a<=t.layersHalf;a++)for(let u=t.layersHalf;u>=-t.layersHalf;u--)l[o]=[2*a/t.layers,2*u/t.layers,s],o++;k(r,e,t,l,n,i)}function Te(r,e,t,n,s,i){if(t.layersEven){let a=Array(t.layersSq),u=0;for(let f=0;f<t.layers;f++)for(let h=t.layers-1;h>=0;h--){let m=-1+1/t.layers+h*2/t.layers,c=-1+1/t.layers+f*2/t.layers;a[u]=[m,c,s],u++}k(r,e,t,a,n,i);return}let l=Array(t.layersSq),o=0;for(let a=-t.layersHalf;a<=t.layersHalf;a++)for(let u=t.layersHalf;u>=-t.layersHalf;u--)l[o]=[2*u/t.layers,2*a/t.layers,s],o++;k(r,e,t,l,n,i)}function Ee(r,e,t,n,s,i){if(t.layersEven){let a=Array(t.layersSq),u=0;for(let f=0;f<t.layers;f++)for(let h=0;h<t.layers;h++){let m=-1+1/t.layers+f*2/t.layers,c=-1+1/t.layers+h*2/t.layers;a[u]=[m,c,s],u++}k(r,e,t,a,n,i);return}let l=Array(t.layersSq),o=0;for(let a=-t.layersHalf;a<=t.layersHalf;a++)for(let u=-t.layersHalf;u<=t.layersHalf;u++)l[o]=[2*a/t.layers,2*u/t.layers,s],o++;k(r,e,t,l,n,i)}function Oe(r,e,t,n,s,i){if(t.layersEven){let a=Array(t.layersSq),u=0;for(let f=0;f<t.layers;f++)for(let h=t.layers-1;h>=0;h--){let m=-1+1/t.layers+h*2/t.layers,c=-1+1/t.layers+f*2/t.layers;a[u]=[m,c,s],u++}k(r,e,t,a,n,i);return}let l=Array(t.layersSq),o=0;for(let a=-t.layersHalf;a<=t.layersHalf;a++)for(let u=t.layersHalf;u>=-t.layersHalf;u--)l[o]=[2*u/t.layers,2*a/t.layers,s],o++;k(r,e,t,l,n,i)}function ve(r,e,t,n,s,i){if(t.layersEven){let a=Array(t.layersSq),u=0;for(let f=t.layers-1;f>=0;f--)for(let h=t.layers-1;h>=0;h--){let m=-1+1/t.layers+h*2/t.layers,c=-1+1/t.layers+f*2/t.layers;a[u]=[m,c,s],u++}k(r,e,t,a,n,i);return}let l=Array(t.layersSq),o=0;for(let a=t.layersHalf;a>=-t.layersHalf;a--)for(let u=t.layersHalf;u>=-t.layersHalf;u--)l[o]=[2*u/t.layers,2*a/t.layers,s],o++;k(r,e,t,l,n,i)}function k(r,e,t,n,s,i){for(let l=0;l<t.layersSq;l++){let o=n[l];Ce(r,e+l*xt,t,o[0],o[1],o[2],s,i)}}function Ce(r,e,t,n,s,i,l,o){let a=1/t.layers-o,u=[[n-a,s-a,i],[n+a,s-a,i],[n+a,s+a,i],[n-a,s+a,i]];for(let f=0;f<Le;f++){let h=u[f];r[e+f*j]=h[(l+0)%j],r[e+f*j+1]=h[(l+1)%j],r[e+f*j+2]=h[(l+2)%j]}}var V=class{constructor(){this.position=0,this._velocity=200,this._acceleration=0,this.target=0}update(e){let t=-100*(this.position-this.target),n=-15*this._velocity;this._acceleration=t+n,this._velocity+=this._acceleration*e,this.position+=this._velocity*e}};function rt(r,e){return Math.floor(r/e.layersSq)}function Y(r){return Math.floor(Math.random()*r)}function bt(r){let e=r.length;for(;e!=0;){let t=Y(e);e--;let n=r[t];r[t]=r[e],r[e]=n}return r}var M=0,q=1,P=2,H=3,U=4,I=5,Be=[[M,H,U],[M,I,H],[M,U,q],[M,q,I],[P,q,U],[P,I,q],[P,U,H],[P,H,I]],De=[[M,H],[M,U],[M,I],[M,q],[q,U],[q,I],[P,q],[P,U],[P,I],[P,H],[H,U],[H,I]];function Lt(r){let e=kt(12,2),t=kt(8,3),n=nt(8),s=nt(12);for(;gt(n)!==gt(s);)n=nt(8);let i=Array(54);for(let d=0;d<6;d++){let E=r.center(d);i[E]=d}let l=r.corners(0,0),o=r.corners(1,0),a=r.corners(2,0),u=r.corners(3,0),f=r.corners(4,0),h=r.corners(5,0),m=(d,E,G,O,v,C,B,D,_)=>{let b=(R,F)=>Be[n[R]][(t[R]+F)%3];i[d.topLeft]=b(E,C),i[d.topRight]=b(G,B),i[d.bottomLeft]=b(O,D),i[d.bottomRight]=b(v,_)};m(l,0,1,2,3,0,0,0,0),m(o,2,3,4,5,2,1,1,2),m(a,4,5,6,7,0,0,0,0),m(u,6,7,0,1,2,1,1,2),m(f,0,2,6,4,2,1,1,2),m(h,3,1,5,7,2,1,1,2);let c=r.edges(0,0,0),p=r.edges(1,0,0),S=r.edges(2,0,0),x=r.edges(3,0,0),g=r.edges(4,0,0),K=r.edges(5,0,0),A=(d,E,G,O,v,C,B,D,_)=>{let b=(R,F)=>De[s[R]][(e[R]+F)%2];i[d.top]=b(E,C),i[d.left]=b(G,B),i[d.right]=b(O,D),i[d.bottom]=b(v,_)};return A(c,0,1,2,3,0,0,0,0),A(p,3,4,5,6,1,0,0,1),A(S,6,7,8,9,0,0,0,0),A(x,9,10,11,0,1,0,0,1),A(g,1,10,4,7,1,1,1,1),A(K,2,5,11,8,1,1,1,1),i}function kt(r,e){let t=Array(r);for(let n=0;n<r;n++)t[n]=Y(e);for(;!_e(t,e);){let n=Y(r);t[n]=Y(e)}return t}function _e(r,e){let t=0;for(let n=0;n<r.length;n++)t+=r[n];return t%e===0}function nt(r){let e=Array(r);for(let t=0;t<r;t++)e[t]=t;return bt(e),e}function gt(r){let e=[...r],t=!1;for(;;)if(e[0]===0){let n=e.findIndex((s,i)=>s!==i);if(n===-1)return t;e[0]=e[n],e[n]=0,t=!t}else{let n=e[0];e[0]=e[n],e[n]=n,t=!t}}var Fe=document.querySelector("canvas"),W=Fe.getContext("webgl");function st(r,e){let t=[e[0],e[1],e[2],e[3],e[0],e[1],e[2],e[3],e[0],e[1],e[2],e[3],e[0],e[1],e[2],e[3]];W.bindBuffer(W.ARRAY_BUFFER,r.buffer),W.bufferData(W.ARRAY_BUFFER,new Float32Array(t),W.STATIC_DRAW)}var X=class{constructor(){this.animationQueue=[]}new(){this.axis=0,this.stickers=Array(this.numOfStickers),this.underStickers=Array(this.numOfStickers);for(let e=0;e<this.numOfStickers;e++){let t=rt(e,this);this.stickers[e]={face:t,buffer:W.createBuffer()},this.underStickers[e]={face:t,buffer:W.createBuffer()},st(this.underStickers[e],pt)}this.affectedStickers=Array(this.numOfStickers).fill(!1)}isSolved(){let e;for(let t=0;t<this.numOfStickers;t++){if(t%this.layersSq===0){e=this.stickers[t].face;continue}if(e!==this.stickers[t].face)return!1}return!0}setColors(e){for(let t=0;t<this.numOfStickers;t++)this.setColor(e[t],t)}setColor(e,t){st(this.stickers[t],e)}solve(){let e=Array(this.numOfStickers);for(let t=0;t<this.numOfStickers;t++)e[t]=Q(rt(t,this));this.setColors(e)}scramble(){if(this.layers===3){this.scramble3x3();return}this.naiveScramble()}scramble3x3(){let e=Lt(this);this.setCubeState(e)}naiveScramble(){let e=this.layersSq*10;for(let t=0;t<e;t++){let n=Math.floor(Math.random()*3),s=Math.floor(Math.random()*this.layers),i=Math.floor(Math.random()*1)==0;this._matchTurn(n,s,i)}}setNumOfLayers(e){this.layers=e,this.layersSq=e*e,this.layersHalf=Math.floor(this.layers/2),this.layersEven=this.layers%2==0,this.numOfStickers=this.layersSq*6}getCubeState(){return this.stickers.map(e=>e.face)}setCubeState(e){for(let t=0;t<this.numOfStickers;t++){let n=Q(e[t]);this.stickers[t].face=e[t],st(this.stickers[t],n)}}resetAffectedStickers(){this.affectedStickers=Array(this.numOfStickers).fill(this.layers===1)}pushAnimation(e,t,n){let s=t?-1:1,i=[0,0,0];i[e]=s,this.animationQueue.push({axis:i,stickers:n,stickersToAnimate:this.affectedStickers})}turn(e,t,n){this.resetAffectedStickers(),this.pushAnimation(e,n,[...this.stickers]),this._matchTurn(e,t,n)}sliceTurn(e,t){this.affectedStickers=Array(this.numOfStickers).fill(!1),this.pushAnimation(e,t,[...this.stickers]);for(let n=1;n<this.layers-1;n++)this._matchTurn(e,n,t)}wideTurn(e,t,n){this.resetAffectedStickers(),this.pushAnimation(e,n,[...this.stickers]),this._matchTurn(e,t,n);for(let s=1;s<this.layers-1;s++)this._matchTurn(e,s,n)}cubeRotate(e,t){this.resetAffectedStickers(),this.pushAnimation(e,t,[...this.stickers]);for(let n=0;n<this.layers;n++)this._matchTurn(e,n,t)}_matchTurn(e,t,n){e==0?(this._turnXAxis(t,n),t==0?this._turnOuter(5,n):t==this.layers-1&&this._turnOuter(4,!n)):e==1?(this._turnYAxis(t,n),t==0?this._turnOuter(0,n):t==this.layers-1&&this._turnOuter(2,!n)):e==2?(this._turnZAxis(t,n),t==0?this._turnOuter(1,n):t==this.layers-1&&this._turnOuter(3,!n)):console.error(`Axis ${e} not recognized`)}_turnXAxis(e,t){for(let n=1;n<=this.layers;n++)this._cycle(t,0*this.layersSq+this.layersSq-n-e*this.layers,3*this.layersSq+this.layersSq-n-e*this.layers,2*this.layersSq+this.layersSq-n-e*this.layers,1*this.layersSq+this.layersSq-n-e*this.layers)}_turnYAxis(e,t){for(let n=0;n<this.layers;n++)this._cycle(t,1*this.layersSq+n*this.layers+e,4*this.layersSq+n*this.layers+e,3*this.layersSq+(this.layers-n-1)*this.layers+(this.layers-1)-e,5*this.layersSq+n*this.layers+e)}_turnZAxis(e,t){for(let n=0;n<this.layers;n++)this._cycle(t,0*this.layersSq+(n+1)*this.layers-1-e,5*this.layersSq+n+this.layers*e,2*this.layersSq+(this.layers-n-1)*this.layers+e,4*this.layersSq+this.layersSq-(n+1)-e*this.layers)}_turnOuter(e,t){if(this.layers%2!=0){let n=this.center(e);this.affectedStickers[n]=!0}for(let n=0;n<Math.floor(this.layers/2);n++){let{topLeft:s,topRight:i,bottomLeft:l,bottomRight:o}=this.corners(e,n);this._cycle(t,s,i,o,l);let a=this.layers-2*(n+1);for(let u=0;u<a;u++){let{top:f,left:h,bottom:m,right:c}=this.edges(e,n,u);this._cycle(t,f,c,m,h)}}}_cycle(e,t,n,s,i){this.affectedStickers[t]=!0,this.affectedStickers[n]=!0,this.affectedStickers[s]=!0,this.affectedStickers[i]=!0,e?this._cycleHelper(t,n,s,i):this._cycleHelper(i,s,n,t)}_cycleHelper(e,t,n,s){let i=this.stickers[s];this.stickers[s]=this.stickers[n],this.stickers[n]=this.stickers[t],this.stickers[t]=this.stickers[e],this.stickers[e]=i}matchKeyToTurn(e){if(this.disableTurn||e.ctrlKey)return;switch(e.code){case"KeyN":return this.cubeRotate(0,!0),{notation:"x",rotate:!0};case"KeyB":return this.cubeRotate(0,!1),{notation:"x'",rotate:!0};case"Semicolon":return this.cubeRotate(1,!0),{notation:"y",rotate:!0};case"KeyA":return this.cubeRotate(1,!1),{notation:"y'",rotate:!0};case"KeyP":return this.cubeRotate(2,!0),{notation:"z",rotate:!0};case"KeyQ":return this.cubeRotate(2,!1),{notation:"z'",rotate:!0};case"KeyJ":return this.turn(1,0,!0),{notation:"U",turn:!0};case"KeyF":return this.turn(1,0,!1),{notation:"U'",turn:!0};case"KeyS":return this.turn(1,this.layers-1,!1),{notation:"D",turn:!0};case"KeyL":return this.turn(1,this.layers-1,!0),{notation:"D'",turn:!0};case"KeyH":return this.turn(2,0,!0),{notation:"F",turn:!0};case"KeyG":return this.turn(2,0,!1),{notation:"F'",turn:!0};case"KeyW":return this.turn(2,this.layers-1,!1),{notation:"B",turn:!0};case"KeyO":return this.turn(2,this.layers-1,!0),{notation:"B'",turn:!0};case"KeyD":return this.turn(0,this.layers-1,!1),{notation:"L",turn:!0};case"KeyE":return this.turn(0,this.layers-1,!0),{notation:"L'",turn:!0};case"KeyI":return this.turn(0,0,!0),{notation:"R",turn:!0};case"KeyK":return this.turn(0,0,!1),{notation:"R'",turn:!0};case"BracketLeft":return this.sliceTurn(0,!1),{notation:"M",turn:!0};case"Quote":return this.sliceTurn(0,!0),{notation:"M'",turn:!0};case"KeyC":return this.sliceTurn(1,!1),{notation:"E",turn:!0};case"Comma":return this.sliceTurn(1,!0),{notation:"E'",turn:!0};case"KeyY":return this.sliceTurn(2,!0),{notation:"S",turn:!0};case"KeyT":return this.sliceTurn(2,!1),{notation:"S'",turn:!0};case"KeyU":return this.wideTurn(0,0,!0),{notation:"r",turn:!0};case"KeyM":return this.wideTurn(0,0,!1),{notation:"r'",turn:!0};case"KeyV":return this.wideTurn(0,this.layers-1,!1),{notation:"l",turn:!0};case"KeyR":return this.wideTurn(0,this.layers-1,!0),{notation:"l'",turn:!0}}}stepAlgorithm(e,t){switch(e){case"x":this.cubeRotate(0,t);break;case"x'":this.cubeRotate(0,!t);break;case"x2":this.cubeRotate(0,t),this.cubeRotate(0,t);break;case"y":this.cubeRotate(1,t);break;case"y'":this.cubeRotate(1,!t);break;case"y2":this.cubeRotate(1,t),this.cubeRotate(1,t);break;case"z":this.cubeRotate(2,t);break;case"z'":this.cubeRotate(2,!t);break;case"z2":this.cubeRotate(2,t),this.cubeRotate(2,t);break;case"U":this.turn(1,0,t);break;case"U'":this.turn(1,0,!t);break;case"U2":case"U2'":this.turn(1,0,t),this.turn(1,0,t);break;case"D":this.turn(1,this.layers-1,!t);break;case"D'":this.turn(1,this.layers-1,t);break;case"D2":this.turn(1,this.layers-1,t),this.turn(1,this.layers-1,t);break;case"F":this.turn(2,0,t);break;case"F'":this.turn(2,0,!t);break;case"F2":this.turn(2,0,t),this.turn(2,0,t);break;case"B":this.turn(2,this.layers-1,!t);break;case"B'":this.turn(2,this.layers-1,t);break;case"B2":this.turn(2,this.layers-1,t),this.turn(2,this.layers-1,t);break;case"L":this.turn(0,this.layers-1,!t);break;case"L'":this.turn(0,this.layers-1,t);break;case"L2":this.turn(0,this.layers-1,t),this.turn(0,this.layers-1,t);break;case"l":this.wideTurn(0,this.layers-1,!t);break;case"l'":this.wideTurn(0,this.layers-1,t);break;case"R":this.turn(0,0,t);break;case"R'":this.turn(0,0,!t);break;case"R2":case"R2'":this.turn(0,0,t),this.turn(0,0,t);break;case"r":this.wideTurn(0,0,t);break;case"r'":this.wideTurn(0,0,!t);break;case"r2":case"r2'":this.wideTurn(0,0,t),this.wideTurn(0,0,t);break;case"M":this.turn(0,1,!t);break;case"M'":this.turn(0,1,t);break;case"M2":this.sliceTurn(0,t),this.sliceTurn(0,t);break;case"E":this.sliceTurn(1,!t);break;case"E'":this.sliceTurn(1,t);break;case"S":this.sliceTurn(2,t);break;case"S'":this.sliceTurn(2,!t);break;default:throw new Error("Invalid turn in algorithm: "+e)}}execAlg(e){if(!e)return;let t=e.split(" ");for(let n=0;n<t.length;n++)this.stepAlgorithm(t[n],!0);this.animationQueue=[]}execAlgReverse(e){if(!e)return;let t=e.split(" ");for(let n=t.length-1;n>=0;n--)this.stepAlgorithm(t[n],!1);this.animationQueue=[]}stickerIsOnFace(e,t){return t*this.layersSq<=e&&e<(t+1)*this.layersSq}center(e){return e*this.layersSq+Math.floor(this.layersSq/2)}corners(e,t){let n=e*this.layersSq;return{topLeft:n+(this.layers+1)*t,topRight:n+(this.layers-1)*(this.layers-t),bottomRight:n+(this.layers+1)*(this.layers-t-1),bottomLeft:n+(this.layers-1)*(t+1)}}edges(e,t,n){let s=this.corners(e,t),i=this.layers-2*(t+1);return{top:s.topLeft+this.layers*(n+1),left:s.topLeft+(i-n),right:s.topRight+n+1,bottom:s.bottomLeft+this.layers*(i-n)}}};function At(r,e){return r/e*2-1}function Rt(r,e){return 1-r/e*2}function it(r,e,t,n){return r<t?(n-e)/(t-r):(e-n)/(r-t)}function N(r,e,t,n,s,i){return Math.abs(.5*(r*(n-i)+t*(i-e)+s*(e-n)))}function Me(r,e){return r.layers-1-e%r.layers}function ot(r,e){return r.layers-1-Math.floor(e/r.layers)}function qe(r,e){return e%r.layers}function at(r,e){return r.layers-1-Math.floor((e-r.layersSq)/r.layers)}var $=class{onPointerDown(e,t,n,s,i){this.numOfPointerMoves=0;let l=At(e,n.clientWidth),o=Rt(t,n.clientHeight);this.xOnDown=l,this.yOnDown=o,[this.stickerOnDown,this.cart2dOnDown]=this._coordinatesToSticker(l,o,s,i);function a(S,x,g){return{x:i[S].cart2d[x],y:i[S].cart2d[g]}}if(this.stickerOnDown!==-1)return;let u=a(0,0,1),f=a(s.layers*(s.layers-1),6,7),h=a(s.layers-1,2,3),m=a(s.layersSq-1,4,5),c=a(s.layers*(s.layers+1)-1,0,1),p=a(s.layersSq*2-1,2,3);o>u.y&&l>u.x&&l<f.x?s.cubeRotate(0,!0):l<u.x&&o>h.y&&o<u.y?s.cubeRotate(2,!1):l>f.x&&o>m.y&&o<f.y?s.cubeRotate(2,!0):l<c.x&&o>c.y&&o<h.y?s.cubeRotate(1,!0):l>p.x&&o>p.y&&o<m.y?s.cubeRotate(1,!1):o<c.y&&l>c.x&&l<p.x&&s.cubeRotate(0,!1)}onPointerMove(e,t){this.numOfPointerMoves++,this.xOnMove=e,this.yOnMove=t}onPointerUp(e,t,n){if(this.numOfPointerMoves<2)return;let s,i;if(this.stickerOnDown!==-1&&(s=it(this.cart2dOnDown[0],this.cart2dOnDown[1],this.cart2dOnDown[4],this.cart2dOnDown[5]),i=it(this.cart2dOnDown[2],this.cart2dOnDown[3],this.cart2dOnDown[6],this.cart2dOnDown[7]),s<0)){let h=s;s=i,i=h}let l=At(this.xOnMove,e.clientWidth),o=Rt(this.yOnMove,e.clientHeight),a=it(l,o,this.xOnDown,this.yOnDown),[u,f]=this._coordinatesToSticker(l,o,t,n);t.stickerIsOnFace(this.stickerOnDown,0)?l===this.xOnDown?t.turn(0,ot(t,this.stickerOnDown),o>this.yOnDown):a>s?t.turn(0,ot(t,this.stickerOnDown),l>this.xOnDown):a<i?t.turn(0,ot(t,this.stickerOnDown),l<this.xOnDown):t.turn(2,Me(t,this.stickerOnDown),l>this.xOnDown):t.stickerIsOnFace(this.stickerOnDown,1)&&(l===this.xOnDown?t.turn(0,at(t,this.stickerOnDown),o>this.yOnDown):a>s?t.turn(0,at(t,this.stickerOnDown),l>this.xOnDown):a<i?t.turn(0,at(t,this.stickerOnDown),l<this.xOnDown):t.turn(1,qe(t,this.stickerOnDown),l<this.xOnDown))}_coordinatesToSticker(e,t,n,s){let i=l=>{if(!s[l].cart2d)return;let o=s[l].cart2d,a=N(o[0],o[1],o[2],o[3],o[4],o[5])+N(o[0],o[1],o[4],o[5],o[6],o[7]),u=N(e,t,o[0],o[1],o[2],o[3])+N(e,t,o[2],o[3],o[4],o[5])+N(e,t,o[4],o[5],o[6],o[7])+N(e,t,o[6],o[7],o[0],o[1]),f=1e-5;if(Math.abs(a-u)<f)return[l,o]};for(let l=0;l<2*n.layersSq;l++){let o=i(l);if(o)return o}for(let l=4*n.layersSq;l<5*n.layersSq;l++){let o=i(l);if(o)return o}return[-1,void 0]}};function lt(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Tt(r,e,t,n,s){let i=1/Math.tan(e/2);if(r[0]=i/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=i,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,s!=null&&s!==1/0){let l=1/(n-s);r[10]=(s+n)*l,r[14]=2*s*n*l}else r[10]=-1,r[14]=-2*n;return r}function J(r,e,t,n){let s=n[0],i=n[1],l=n[2],o=1/Math.hypot(s,i,l);s*=o,i*=o,l*=o;let a=Math.sin(t),u=Math.cos(t),f=1-u,h=e[0],m=e[1],c=e[2],p=e[3],S=e[4],x=e[5],g=e[6],K=e[7],A=e[8],d=e[9],E=e[10],G=e[11],O=s*s*f+u,v=i*s*f+l*a,C=l*s*f-i*a,B=s*i*f-l*a,D=i*i*f+u,_=l*i*f+s*a,b=s*l*f+i*a,R=i*l*f-s*a,F=l*l*f+u;return r[0]=h*O+S*v+A*C,r[1]=m*O+x*v+d*C,r[2]=c*O+g*v+E*C,r[3]=p*O+K*v+G*C,r[4]=h*B+S*D+A*_,r[5]=m*B+x*D+d*_,r[6]=c*B+g*D+E*_,r[7]=p*B+K*D+G*_,r[8]=h*b+S*R+A*F,r[9]=m*b+x*R+d*F,r[10]=c*b+g*R+E*F,r[11]=p*b+K*R+G*F,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r}function Et(r,e){let t=e[0],n=e[1],s=e[2];return r[12]+=r[0]*t+r[4]*n+r[7]*s,r[13]+=r[1]*t+r[5]*n+r[8]*s,r[14]+=r[2]*t+r[5]*n+r[9]*s,r[15]+=r[3]*t+r[6]*n+r[10]*s,r}function Ot(){let r;return e=>(r||(r=e()),r)}var He="animateTurns",Ue="hintStickers";var Ie="showBody";function vt(){var r;return(r=ct(Ue))!=null?r:!0}function Ct(){var r;return(r=ct(Ie))!=null?r:!0}function Bt(){var r;return(r=ct(He))!=null?r:!0}function ct(r){let e=localStorage.getItem(r);return e===null?null:e=="1"}var L=document.querySelector("canvas"),y=L.getContext("webgl"),w=Ge(),Z=[],T={animateTurns:!0,dragEnabled:!0,hintStickers:!0,showBody:!0};function Mt(){T.animateTurns=Bt(),T.hintStickers=vt(),T.showBody=Ct()}var Dt=Date.now()*.001,Ke=3,_t=!1;function qt(){_t||(_t=!0,requestAnimationFrame(Ht))}function Pt(r){let e=document.querySelector(r),t=new X,n=new V,s=We(e),i=new $;t.setNumOfLayers(Ke),t.new();let l=St(y,t,s),o=(c,p)=>{!T.dragEnabled||i.onPointerDown(c,p,e,t,l)},a=(c,p)=>{!T.dragEnabled||i.onPointerMove(c,p)},u=()=>{!T.dragEnabled||i.onPointerUp(e,t,l)},f=c=>{let p=c.target.getBoundingClientRect(),S=c.touches[0].pageX-p.left,x=c.touches[0].pageY-p.top;return{x:S,y:x}},h=()=>{e.addEventListener("pointerdown",c=>o(c.offsetX,c.offsetY)),e.addEventListener("pointermove",c=>a(c.offsetX,c.offsetY)),e.addEventListener("pointerup",c=>u())},m=()=>{e.addEventListener("touchstart",c=>{let{x:p,y:S}=f(c);o(p,S)}),e.addEventListener("touchmove",c=>{let{x:p,y:S}=f(c);a(p,S)}),e.addEventListener("touchend",c=>{u()})};return window.PointerEvent?h():m(),{div:e,cube:t,spring:n,buffers:l,transformMatrix:s}}function Ge(){let t=je(y,`
    attribute vec4 aVertexPosition;
    attribute vec4 aVertexColor;
    uniform mat4 uTransformMatrix;
    varying lowp vec4 vColor;
    void main(void) {
        gl_Position = uTransformMatrix * aVertexPosition;
        vColor = aVertexColor;
    }
    `,`
    varying lowp vec4 vColor;
    void main(void) {
        gl_FragColor = vColor;
    }
    `);return y.useProgram(t),{attribLocations:{vertexPosition:y.getAttribLocation(t,"aVertexPosition"),vertexColor:y.getAttribLocation(t,"aVertexColor")},uniformLocations:{transformMatrix:y.getUniformLocation(t,"uTransformMatrix")}}}function We(r){let e=lt();return Tt(e,50*Math.PI/180,r.clientWidth/r.clientHeight,.1,100),Et(e,[0,0,-5]),J(e,e,45*Math.PI/180,[1,0,0]),J(e,e,0,[0,-1,0]),e}function ut(r,e,t){t.bindBuffer(t.ARRAY_BUFFER,r),t.vertexAttribPointer(e.attribLocations.vertexPosition,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(e.attribLocations.vertexPosition)}function ft(r,e,t){t.bindBuffer(t.ARRAY_BUFFER,r),t.vertexAttribPointer(e.attribLocations.vertexColor,4,t.FLOAT,!1,0,0),t.enableVertexAttribArray(e.attribLocations.vertexColor)}function ht(r){r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0)}function je(r,e,t){let n=Ft(r,r.VERTEX_SHADER,e),s=Ft(r,r.FRAGMENT_SHADER,t),i=r.createProgram();return r.attachShader(i,n),r.attachShader(i,s),r.linkProgram(i),r.getProgramParameter(i,r.LINK_STATUS)?i:(alert("Unable to initialize the shader program: "+r.getProgramInfoLog(i)),null)}function Ft(r,e,t){let n=r.createShader(e);return r.shaderSource(n,t),r.compileShader(n),r.getShaderParameter(n,r.COMPILE_STATUS)?n:(alert("An error occurred compiling the shaders: "+r.getShaderInfoLog(n)),r.deleteShader(n),null)}function Ye(){let r=L.clientWidth,e=L.clientHeight,t=L.width!==r||L.height!==e;return t&&(L.width=r,L.height=e),t}function Ht(r){r*=.001;let e=r-Dt;Dt=r,Ye(),y.enable(y.DEPTH_TEST),y.enable(y.SCISSOR_TEST),y.depthFunc(y.LEQUAL),y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT),L.style.transform=`translateY(${window.scrollY}px)`;for(let t=0;t<Z.length;t++){let{cube:n,div:s,spring:i,buffers:l,transformMatrix:o}=Z[t],a=s.getBoundingClientRect();if(a.bottom<0||a.top>L.clientHeight||a.right<0||a.left>L.clientWidth)continue;let u=a.right-a.left,f=a.bottom-a.top,h=a.left,m=L.clientHeight-a.bottom;y.viewport(h,m,u,f),y.scissor(h,m,u,f),n.animationQueue[0]&&(i.target=n.animationQueue.length*90,i.update(e),i.position>=90&&(n.affectedStickers=Array(n.numOfStickers).fill(!1),i.position=0,n.animationQueue.shift()));let c=n.animationQueue[0],p=Ne(n),S=Ot();for(let x=0;x<n.numOfStickers;x++){let g=l[x],K=c&&c.stickersToAnimate[x]&&T.animateTurns?S(()=>J(lt(),o,i.position*Math.PI/180,c.axis)):o;y.uniformMatrix4fv(w.uniformLocations.transformMatrix,!1,K),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,g.indexBuffer),T.showBody&&(ut(g.noGapPositionBuffer,w,y),ft(n.underStickers[x].buffer,w,y),ht(y)),ut(g.positionBuffer,w,y),ft(p[x].buffer,w,y),ht(y)}Qe(n,l,o,p)}requestAnimationFrame(Ht)}function Ne(r){return T.animateTurns&&r.animationQueue[0]?r.animationQueue[0].stickers:r.stickers}function Qe(r,e,t,n){if(!!T.hintStickers){y.uniformMatrix4fv(w.uniformLocations.transformMatrix,!1,t);for(let s=2*r.layersSq;s<r.numOfStickers;s++){let i=e[s];ut(i.hintPositionBuffer,w,y),ft(n[s].buffer,w,y),ht(y)}}}function Ut(){let r=document.querySelector(".slideRight"),e=!1;function t(n){if(e=n,e){r.classList.add("slideRightOpen");return}r.classList.remove("slideRightOpen")}document.addEventListener("click",n=>{let s=n.target;if(s===document.querySelector("#menu")){t(!0);return}e&&!s.closest(".slideRight")&&t(!1)}),document.querySelector("#closeMenu").addEventListener("click",()=>{t(!1)}),document.querySelector("#learnButton").addEventListener("click",()=>{document.location.href="learn.html"}),document.querySelector("#playButton").addEventListener("click",()=>{document.location.href="play.html"}),document.querySelector("#trainButton").addEventListener("click",()=>{document.location.href="train.html"}),document.querySelector("#cubleButton").addEventListener("click",()=>{document.location.href="cuble.html"})}function ze(){let r=Pt("#scene");Z.push(r),r.cube.solve(),Mt(),qt(),Ut();let e=document.querySelector("#moveCount"),t=0;function n(){t=0,e.textContent=`Moves: ${t}`}function s(){t+=1,e.textContent=`Moves: ${t}`}n(),document.querySelector("#solve").addEventListener("click",i=>{r.cube.solve(),n()}),document.querySelector("#scramble").addEventListener("click",i=>{r.cube.scramble();for(let l=0;l<54;l++)tt.includes(l)||r.cube.setColor(yt,l);It(r.cube),n()}),document.addEventListener("keydown",i=>{let l=r.cube.matchKeyToTurn(i);l&&l.turn&&(It(r.cube),s())})}function It(r){for(let e=0;e<54;e++)(0<=e&&e<=8&&r.stickers[e].face==r.stickers[4].face||9<=e&&e<=17&&r.stickers[e].face==r.stickers[13].face||18<=e&&e<=26&&r.stickers[e].face==r.stickers[22].face||27<=e&&e<=35&&r.stickers[e].face==r.stickers[31].face||36<=e&&e<=44&&r.stickers[e].face==r.stickers[40].face||45<=e&&e<=53&&r.stickers[e].face==r.stickers[49].face)&&r.setColor(Q(r.stickers[e].face),e)}ze();})();
//# sourceMappingURL=cuble.js.map
