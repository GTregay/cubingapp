(()=>{var Xe=[4,13,22,31,40,49],Ze=[0,29,36],Je=[6,35,51],et=[2,9,42],tt=[8,15,45],rt=[18,11,44],nt=[24,47,17],st=[20,38,27],it=[26,33,53],ot=[3,32],at=[1,39],lt=[7,48],ct=[5,12],ut=[10,43],ht=[16,46],mt=[21,14],ft=[19,41],dt=[25,50],pt=[23,30],yt=[28,37],gt=[34,52],bt=[...Ze,...Je,...et,...tt],xt=[...rt,...nt,...st,...it],St=[...ot,...at,...lt,...ct],kt=[...ut,...ht,...yt,...gt],vt=[...mt,...ft,...dt,...pt],Lt=[...Xe,...St],Tt=[...Lt,...bt],Rt=[...Tt,...kt];var At=[...vt,...xt],y=[...Rt,...At];var Pt=[1,1,1,1],Ae=[.5,.5,.5,1],Bt=[1,1,0,1],Mt=[0,1,0,1],Ct=[0,0,1,1],Ot=[1,.5,0,1],It=[1,0,0,1],Ee=[0,0,0,1],Re=[Pt,Mt,Bt,Ct,Ot,It];function Z(r){return(r<0||r>=Re.length)&&console.error("Invalid face: "+r),Re[r]}function J(r,t){return Math.floor(r/f(t.layers))}function C(r){return Math.floor(Math.random()*r)}function Be(r){let t=r.length;for(;t!=0;){let e=C(t);t--;let n=r[e];r[e]=r[t],r[t]=n}return r}var H=0,W=1,q=2,G=3,K=4,N=5,Dt=[[H,G,K],[H,N,G],[H,K,W],[H,W,N],[q,W,K],[q,N,W],[q,K,G],[q,G,N]],Ft=[[H,G],[H,K],[H,N],[H,W],[W,K],[W,N],[q,W],[q,K],[q,N],[q,G],[G,K],[G,N]];function Oe(r){let t=Me(12,2),e=Me(8,3),n=me(8),s=me(12);for(;Ce(n)!==Ce(s);)n=me(8);let o=Array(54);for(let S=0;S<6;S++){let A=r.center(S);o[A]=S}let l=r.corners(0,0),a=r.corners(1,0),i=r.corners(2,0),c=r.corners(3,0),u=r.corners(4,0),m=r.corners(5,0),h=(S,A,z,O,I,D,F,w,_)=>{let T=(M,U)=>Dt[n[M]][(e[M]+U)%3];o[S.topLeft]=T(A,D),o[S.topRight]=T(z,F),o[S.bottomLeft]=T(O,w),o[S.bottomRight]=T(I,_)};h(l,0,1,2,3,0,0,0,0),h(a,2,3,4,5,2,1,1,2),h(i,4,5,6,7,0,0,0,0),h(c,6,7,0,1,2,1,1,2),h(u,0,2,6,4,2,1,1,2),h(m,3,1,5,7,2,1,1,2);let p=r.edges(0,0,0),d=r.edges(1,0,0),b=r.edges(2,0,0),L=r.edges(3,0,0),k=r.edges(4,0,0),B=r.edges(5,0,0),R=(S,A,z,O,I,D,F,w,_)=>{let T=(M,U)=>Ft[s[M]][(t[M]+U)%2];o[S.top]=T(A,D),o[S.left]=T(z,F),o[S.right]=T(O,w),o[S.bottom]=T(I,_)};return R(p,0,1,2,3,0,0,0,0),R(d,3,4,5,6,1,0,0,1),R(b,6,7,8,9,0,0,0,0),R(L,9,10,11,0,1,0,0,1),R(k,1,10,4,7,1,1,1,1),R(B,2,5,11,8,1,1,1,1),o}function Me(r,t){let e=Array(r);for(let n=0;n<r;n++)e[n]=C(t);for(;!wt(e,t);){let n=C(r);e[n]=C(t)}return e}function wt(r,t){let e=0;for(let n=0;n<r.length;n++)e+=r[n];return e%t===0}function me(r){let t=Array(r);for(let e=0;e<r;e++)t[e]=e;return Be(t),t}function Ce(r){let t=[...r],e=!1;for(;;)if(t[0]===0){let n=t.findIndex((s,o)=>s!==o);if(n===-1)return e;t[0]=t[n],t[n]=0,e=!e}else{let n=t[0];t[0]=t[n],t[n]=n,e=!e}}var _t=document.querySelector("canvas"),$=_t.getContext("webgl");function fe(r,t){let e=[t[0],t[1],t[2],t[3],t[0],t[1],t[2],t[3],t[0],t[1],t[2],t[3],t[0],t[1],t[2],t[3]];$.bindBuffer($.ARRAY_BUFFER,r.buffer),$.bufferData($.ARRAY_BUFFER,new Float32Array(e),$.STATIC_DRAW)}function f(r){return r*r}function x(r){return Math.floor(r/2)}function Q(r){return r%2==0}function v(r){return r*r*6}var ie=class{constructor(){this.animationQueue=[]}setColors(t){for(let e=0;e<v(this.layers);e++)fe(this.stickers[e],t[e])}solve(){let t=Array(v(this.layers));for(let e=0;e<v(this.layers);e++){let n=J(e,this);this.stickers[e].face=n,t[e]=Z(n)}this.setColors(t)}scramble(){if(this.layers===3){this.scramble3x3();return}this.naiveScramble()}scramble3x3(){let t=Oe(this);this.setCubeState(t)}naiveScramble(){let t=f(this.layers)*10;for(let e=0;e<t;e++){let n=Math.floor(Math.random()*3),s=Math.floor(Math.random()*this.layers),o=Math.floor(Math.random()*1)==0;this._matchTurn(n,s,o)}}setNumOfLayers(t){this.layers=t,this.stickers=Array(v(t)),this.underStickers=Array(v(t));for(let e=0;e<v(t);e++){let n=J(e,this);this.stickers[e]={face:n,buffer:$.createBuffer()},this.underStickers[e]={face:n,buffer:$.createBuffer()},fe(this.underStickers[e],Ee)}this.affectedStickers=Array(v(t)).fill(!1)}getCubeState(){return this.stickers.map(t=>t.face)}setCubeState(t){for(let e=0;e<v(this.layers);e++){let n=Z(t[e]);this.stickers[e].face=t[e],fe(this.stickers[e],n)}}resetAffectedStickers(){let t=Array(v(this.layers));this.affectedStickers=t.fill(this.layers===1)}pushAnimation(t,e,n){let s=e?-1:1,o=[0,0,0];o[t]=s,this.animationQueue.push({axis:o,stickers:n,stickersToAnimate:this.affectedStickers})}turn(t,e,n){this.resetAffectedStickers(),this.pushAnimation(t,n,[...this.stickers]),this._matchTurn(t,e,n)}sliceTurn(t,e){let n=Array(v(this.layers));this.affectedStickers=n.fill(!1),this.pushAnimation(t,e,[...this.stickers]);for(let s=1;s<this.layers-1;s++)this._matchTurn(t,s,e)}wideTurn(t,e,n){this.resetAffectedStickers(),this.pushAnimation(t,n,[...this.stickers]),this._matchTurn(t,e,n);for(let s=1;s<this.layers-1;s++)this._matchTurn(t,s,n)}cubeRotate(t,e){this.resetAffectedStickers(),this.pushAnimation(t,e,[...this.stickers]);for(let n=0;n<this.layers;n++)this._matchTurn(t,n,e)}_matchTurn(t,e,n){t==0?(this._turnXAxis(e,n),e==0?this._turnOuter(5,n):e==this.layers-1&&this._turnOuter(4,!n)):t==1?(this._turnYAxis(e,n),e==0?this._turnOuter(0,n):e==this.layers-1&&this._turnOuter(2,!n)):t==2?(this._turnZAxis(e,n),e==0?this._turnOuter(1,n):e==this.layers-1&&this._turnOuter(3,!n)):console.error(`Axis ${t} not recognized`)}_turnXAxis(t,e){for(let n=1;n<=this.layers;n++)this._cycle(e,0*f(this.layers)+f(this.layers)-n-t*this.layers,3*f(this.layers)+f(this.layers)-n-t*this.layers,2*f(this.layers)+f(this.layers)-n-t*this.layers,1*f(this.layers)+f(this.layers)-n-t*this.layers)}_turnYAxis(t,e){for(let n=0;n<this.layers;n++)this._cycle(e,1*f(this.layers)+n*this.layers+t,4*f(this.layers)+n*this.layers+t,3*f(this.layers)+(this.layers-n-1)*this.layers+(this.layers-1)-t,5*f(this.layers)+n*this.layers+t)}_turnZAxis(t,e){for(let n=0;n<this.layers;n++)this._cycle(e,0*f(this.layers)+(n+1)*this.layers-1-t,5*f(this.layers)+n+this.layers*t,2*f(this.layers)+(this.layers-n-1)*this.layers+t,4*f(this.layers)+f(this.layers)-(n+1)-t*this.layers)}_turnOuter(t,e){if(this.layers%2!=0){let n=this.center(t);this.affectedStickers[n]=!0}for(let n=0;n<Math.floor(this.layers/2);n++){let{topLeft:s,topRight:o,bottomLeft:l,bottomRight:a}=this.corners(t,n);this._cycle(e,s,o,a,l);let i=this.layers-2*(n+1);for(let c=0;c<i;c++){let{top:u,left:m,bottom:h,right:p}=this.edges(t,n,c);this._cycle(e,u,p,h,m)}}}_cycle(t,e,n,s,o){this.affectedStickers[e]=!0,this.affectedStickers[n]=!0,this.affectedStickers[s]=!0,this.affectedStickers[o]=!0,t?this._cycleHelper(e,n,s,o):this._cycleHelper(o,s,n,e)}_cycleHelper(t,e,n,s){let o=this.stickers[s];this.stickers[s]=this.stickers[n],this.stickers[n]=this.stickers[e],this.stickers[e]=this.stickers[t],this.stickers[t]=o}matchKeyToTurn(t){if(this.disableTurn||t.ctrlKey)return;switch(t.code){case"KeyN":return this.cubeRotate(0,!0),{notation:"x",rotate:!0};case"KeyB":return this.cubeRotate(0,!1),{notation:"x'",rotate:!0};case"Semicolon":return this.cubeRotate(1,!0),{notation:"y",rotate:!0};case"KeyA":return this.cubeRotate(1,!1),{notation:"y'",rotate:!0};case"KeyP":return this.cubeRotate(2,!0),{notation:"z",rotate:!0};case"KeyQ":return this.cubeRotate(2,!1),{notation:"z'",rotate:!0};case"KeyJ":return this.turn(1,0,!0),{notation:"U",turn:!0};case"KeyF":return this.turn(1,0,!1),{notation:"U'",turn:!0};case"KeyS":return this.turn(1,this.layers-1,!1),{notation:"D",turn:!0};case"KeyL":return this.turn(1,this.layers-1,!0),{notation:"D'",turn:!0};case"KeyH":return this.turn(2,0,!0),{notation:"F",turn:!0};case"KeyG":return this.turn(2,0,!1),{notation:"F'",turn:!0};case"KeyW":return this.turn(2,this.layers-1,!1),{notation:"B",turn:!0};case"KeyO":return this.turn(2,this.layers-1,!0),{notation:"B'",turn:!0};case"KeyD":return this.turn(0,this.layers-1,!1),{notation:"L",turn:!0};case"KeyE":return this.turn(0,this.layers-1,!0),{notation:"L'",turn:!0};case"KeyI":return this.turn(0,0,!0),{notation:"R",turn:!0};case"KeyK":return this.turn(0,0,!1),{notation:"R'",turn:!0};case"BracketLeft":return this.sliceTurn(0,!1),{notation:"M",turn:!0};case"Quote":return this.sliceTurn(0,!0),{notation:"M'",turn:!0};case"KeyC":return this.sliceTurn(1,!1),{notation:"E",turn:!0};case"Comma":return this.sliceTurn(1,!0),{notation:"E'",turn:!0};case"KeyY":return this.sliceTurn(2,!0),{notation:"S",turn:!0};case"KeyT":return this.sliceTurn(2,!1),{notation:"S'",turn:!0};case"KeyU":return this.wideTurn(0,0,!0),{notation:"r",turn:!0};case"KeyM":return this.wideTurn(0,0,!1),{notation:"r'",turn:!0};case"KeyV":return this.wideTurn(0,this.layers-1,!1),{notation:"l",turn:!0};case"KeyR":return this.wideTurn(0,this.layers-1,!0),{notation:"l'",turn:!0}}}stepAlgorithm(t,e){switch(t){case"x":this.cubeRotate(0,e);break;case"x'":this.cubeRotate(0,!e);break;case"x2":case"x2'":this.cubeRotate(0,e),this.cubeRotate(0,e);break;case"y":this.cubeRotate(1,e);break;case"y'":this.cubeRotate(1,!e);break;case"y2":case"y2'":this.cubeRotate(1,e),this.cubeRotate(1,e);break;case"z":this.cubeRotate(2,e);break;case"z'":this.cubeRotate(2,!e);break;case"z2":case"z2'":this.cubeRotate(2,e),this.cubeRotate(2,e);break;case"U":this.turn(1,0,e);break;case"U'":this.turn(1,0,!e);break;case"U2":case"U2'":this.turn(1,0,e),this.turn(1,0,e);break;case"u":this.wideTurn(1,0,e);break;case"u'":this.wideTurn(1,0,!e);break;case"u2":case"u2'":this.wideTurn(1,0,e),this.wideTurn(1,0,e);break;case"D":this.turn(1,this.layers-1,!e);break;case"D'":this.turn(1,this.layers-1,e);break;case"D2":case"D2'":this.turn(1,this.layers-1,e),this.turn(1,this.layers-1,e);break;case"d":this.wideTurn(1,this.layers-1,!e);break;case"d'":this.wideTurn(1,this.layers-1,e);break;case"d2":case"d2'":this.wideTurn(1,this.layers-1,e),this.wideTurn(1,this.layers-1,e);break;case"F":this.turn(2,0,e);break;case"F'":this.turn(2,0,!e);break;case"F2":case"F2'":this.turn(2,0,e),this.turn(2,0,e);break;case"f":this.wideTurn(2,0,e);break;case"f'":this.wideTurn(2,0,!e);break;case"f2":case"f2'":this.wideTurn(2,0,e),this.wideTurn(2,0,e);break;case"B":this.turn(2,this.layers-1,!e);break;case"B'":this.turn(2,this.layers-1,e);break;case"B2":case"B2'":this.turn(2,this.layers-1,e),this.turn(2,this.layers-1,e);break;case"b":this.wideTurn(2,this.layers-1,!e);break;case"b'":this.wideTurn(2,this.layers-1,e);break;case"b2":case"b2'":this.wideTurn(2,this.layers-1,e),this.wideTurn(2,this.layers-1,e);break;case"L":this.turn(0,this.layers-1,!e);break;case"L'":this.turn(0,this.layers-1,e);break;case"L2":case"L2'":this.turn(0,this.layers-1,e),this.turn(0,this.layers-1,e);break;case"l":this.wideTurn(0,this.layers-1,!e);break;case"l'":this.wideTurn(0,this.layers-1,e);break;case"l2":case"l2'":this.wideTurn(0,this.layers-1,e),this.wideTurn(0,this.layers-1,e);break;case"R":this.turn(0,0,e);break;case"R'":this.turn(0,0,!e);break;case"R2":case"R2'":this.turn(0,0,e),this.turn(0,0,e);break;case"r":this.wideTurn(0,0,e);break;case"r'":this.wideTurn(0,0,!e);break;case"r2":case"r2'":this.wideTurn(0,0,e),this.wideTurn(0,0,e);break;case"M":this.turn(0,1,!e);break;case"M'":this.turn(0,1,e);break;case"M2":case"M2'":this.sliceTurn(0,e),this.sliceTurn(0,e);break;case"E":this.sliceTurn(1,!e);break;case"E'":this.sliceTurn(1,e);break;case"E2":case"E2'":this.sliceTurn(1,e),this.sliceTurn(1,e);break;case"S":this.sliceTurn(2,e);break;case"S'":this.sliceTurn(2,!e);break;case"S2":case"S2'":this.sliceTurn(2,e);default:throw new Error("Invalid turn in algorithm: "+t)}}execAlg(t){if(!t)return;let e=t.split(" ");for(let n=0;n<e.length;n++)this.stepAlgorithm(e[n],!0);this.animationQueue=[]}execAlgReverse(t){if(!t)return;let e=t.split(" ");for(let n=e.length-1;n>=0;n--)this.stepAlgorithm(e[n],!1);this.animationQueue=[]}stickerIsOnFace(t,e){return e*f(this.layers)<=t&&t<(e+1)*f(this.layers)}center(t){return t*f(this.layers)+Math.floor(f(this.layers)/2)}corners(t,e){let n=t*f(this.layers);return{topLeft:n+(this.layers+1)*e,topRight:n+(this.layers-1)*(this.layers-e),bottomRight:n+(this.layers+1)*(this.layers-e-1),bottomLeft:n+(this.layers-1)*(e+1)}}edges(t,e,n){let s=this.corners(t,e),o=this.layers-2*(e+1);return{top:s.topLeft+this.layers*(n+1),left:s.topLeft+(o-n),right:s.topRight+n+1,bottom:s.bottomLeft+this.layers*(o-n)}}};function ae(r,t,e){let n=de(t,1.01,.02),s=de(t,1,0),o=de(t,1.5,.02),l=Array(v(t.layers));for(let a=0;a<v(t.layers);a++){let i={positionBuffer:r.createBuffer(),noGapPositionBuffer:r.createBuffer(),hintPositionBuffer:r.createBuffer(),indexBuffer:r.createBuffer(),cart2d:[],positions:null},c=new Float32Array(12),u=new Float32Array(12),m=new Float32Array(12);for(let d=0;d<12;d++){let b=a*12+d;c[d]=n[b],u[d]=s[b],m[d]=o[b]}r.bindBuffer(r.ARRAY_BUFFER,i.positionBuffer),r.bufferData(r.ARRAY_BUFFER,c,r.STATIC_DRAW),i.positions=c,r.bindBuffer(r.ARRAY_BUFFER,i.noGapPositionBuffer),r.bufferData(r.ARRAY_BUFFER,u,r.STATIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,i.hintPositionBuffer),r.bufferData(r.ARRAY_BUFFER,m,r.STATIC_DRAW);let h=Array(16);oe(h,0,e,[u[0],u[1],u[2],1]),oe(h,4,e,[u[3],u[4],u[5],1]),oe(h,8,e,[u[6],u[7],u[8],1]),oe(h,12,e,[u[9],u[10],u[11],1]),i.cart2d=[h[0]/h[3],h[1]/h[3],h[4]/h[7],h[5]/h[7],h[8]/h[11],h[9]/h[11],h[12]/h[15],h[13]/h[15]];let p=[0,1,2,0,2,3];r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i.indexBuffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,new Uint16Array(p),r.STATIC_DRAW),l[a]=i}return l}function oe(r,t,e,n){let s=Array(4),o=n[0],l=n[1],a=n[2],i=n[3];r[t+0]=o*e[0]+l*e[4]+a*e[8]+i*e[12],r[t+1]=o*e[1]+l*e[5]+a*e[9]+i*e[13],r[t+2]=o*e[2]+l*e[6]+a*e[10]+i*e[14],r[t+3]=o*e[3]+l*e[7]+a*e[11]+i*e[15]}var Ie=12,Ut=4,V=3;function de(r,t,e){let n=f(r.layers)*Ie,s=Array(6*n);return Ht(s,0*n,r,1,t,e),Wt(s,1*n,r,0,t,e),qt(s,2*n,r,1,-t,e),Gt(s,3*n,r,0,-t,e),Kt(s,4*n,r,2,-t,e),Nt(s,5*n,r,2,t,e),s}function Ht(r,t,e,n,s,o){if(Q(e.layers)){let i=Array(f(e.layers)),c=0;for(let u=0;u<e.layers;u++)for(let m=0;m<e.layers;m++){let h=-1+1/e.layers+m*2/e.layers,p=-1+1/e.layers+u*2/e.layers;i[c]=[h,p,s],c++}E(r,t,e,i,n,o);return}let l=Array(f(e.layers)),a=0;for(let i=-x(e.layers);i<=x(e.layers);i++)for(let c=-x(e.layers);c<=x(e.layers);c++)l[a]=[2*c/e.layers,2*i/e.layers,s],a++;E(r,t,e,l,n,o)}function Wt(r,t,e,n,s,o){if(Q(e.layers)){let i=Array(f(e.layers)),c=0;for(let u=0;u<e.layers;u++)for(let m=e.layers-1;m>=0;m--){let h=-1+1/e.layers+u*2/e.layers,p=-1+1/e.layers+m*2/e.layers;i[c]=[h,p,s],c++}E(r,t,e,i,n,o);return}let l=Array(f(e.layers)),a=0;for(let i=-x(e.layers);i<=x(e.layers);i++)for(let c=x(e.layers);c>=-x(e.layers);c--)l[a]=[2*i/e.layers,2*c/e.layers,s],a++;E(r,t,e,l,n,o)}function qt(r,t,e,n,s,o){if(Q(e.layers)){let i=Array(f(e.layers)),c=0;for(let u=0;u<e.layers;u++)for(let m=e.layers-1;m>=0;m--){let h=-1+1/e.layers+m*2/e.layers,p=-1+1/e.layers+u*2/e.layers;i[c]=[h,p,s],c++}E(r,t,e,i,n,o);return}let l=Array(f(e.layers)),a=0;for(let i=-x(e.layers);i<=x(e.layers);i++)for(let c=x(e.layers);c>=-x(e.layers);c--)l[a]=[2*c/e.layers,2*i/e.layers,s],a++;E(r,t,e,l,n,o)}function Gt(r,t,e,n,s,o){if(Q(e.layers)){let i=Array(f(e.layers)),c=0;for(let u=0;u<e.layers;u++)for(let m=0;m<e.layers;m++){let h=-1+1/e.layers+u*2/e.layers,p=-1+1/e.layers+m*2/e.layers;i[c]=[h,p,s],c++}E(r,t,e,i,n,o);return}let l=Array(f(e.layers)),a=0;for(let i=-x(e.layers);i<=x(e.layers);i++)for(let c=-x(e.layers);c<=x(e.layers);c++)l[a]=[2*i/e.layers,2*c/e.layers,s],a++;E(r,t,e,l,n,o)}function Kt(r,t,e,n,s,o){if(Q(e.layers)){let i=Array(f(e.layers)),c=0;for(let u=0;u<e.layers;u++)for(let m=e.layers-1;m>=0;m--){let h=-1+1/e.layers+m*2/e.layers,p=-1+1/e.layers+u*2/e.layers;i[c]=[h,p,s],c++}E(r,t,e,i,n,o);return}let l=Array(f(e.layers)),a=0;for(let i=-x(e.layers);i<=x(e.layers);i++)for(let c=x(e.layers);c>=-x(e.layers);c--)l[a]=[2*c/e.layers,2*i/e.layers,s],a++;E(r,t,e,l,n,o)}function Nt(r,t,e,n,s,o){if(Q(e.layers)){let i=Array(f(e.layers)),c=0;for(let u=e.layers-1;u>=0;u--)for(let m=e.layers-1;m>=0;m--){let h=-1+1/e.layers+m*2/e.layers,p=-1+1/e.layers+u*2/e.layers;i[c]=[h,p,s],c++}E(r,t,e,i,n,o);return}let l=Array(f(e.layers)),a=0;for(let i=x(e.layers);i>=-x(e.layers);i--)for(let c=x(e.layers);c>=-x(e.layers);c--)l[a]=[2*c/e.layers,2*i/e.layers,s],a++;E(r,t,e,l,n,o)}function E(r,t,e,n,s,o){for(let l=0;l<f(e.layers);l++){let a=n[l];jt(r,t+l*Ie,e,a[0],a[1],a[2],s,o)}}function jt(r,t,e,n,s,o,l,a){let i=1/e.layers-a,c=[[n-i,s-i,o],[n+i,s-i,o],[n+i,s+i,o],[n-i,s+i,o]];for(let u=0;u<Ut;u++){let m=c[u];r[t+u*V]=m[(l+0)%V],r[t+u*V+1]=m[(l+1)%V],r[t+u*V+2]=m[(l+2)%V]}}var le=class{constructor(){this.position=0,this._velocity=200,this._acceleration=0,this.target=0}update(t){let e=-100*(this.position-this.target),n=-15*this._velocity;this._acceleration=e+n,this._velocity+=this._acceleration*t,this.position+=this._velocity*t}};function De(r,t){return r/t*2-1}function Fe(r,t){return 1-r/t*2}function pe(r,t,e,n){return r<e?(n-t)/(e-r):(t-n)/(r-e)}function X(r,t,e,n,s,o){return Math.abs(.5*(r*(n-o)+e*(o-t)+s*(t-n)))}function Yt(r,t){return r.layers-1-t%r.layers}function ye(r,t){return r.layers-1-Math.floor(t/r.layers)}function zt(r,t){return t%r.layers}function ge(r,t){return r.layers-1-Math.floor((t-f(r.layers))/r.layers)}var ce=class{onPointerDown(t,e,n,s,o){this.numOfPointerMoves=0;let l=De(t,n.clientWidth),a=Fe(e,n.clientHeight);this.xOnDown=l,this.yOnDown=a,[this.stickerOnDown,this.cart2dOnDown]=this._coordinatesToSticker(l,a,s,o);function i(b,L,k){return{x:o[b].cart2d[L],y:o[b].cart2d[k]}}if(this.stickerOnDown!==-1)return;let c=i(0,0,1),u=i(s.layers*(s.layers-1),6,7),m=i(s.layers-1,2,3),h=i(f(s.layers)-1,4,5),p=i(s.layers*(s.layers+1)-1,0,1),d=i(f(s.layers)*2-1,2,3);a>c.y&&l>c.x&&l<u.x?s.cubeRotate(0,!0):l<c.x&&a>m.y&&a<c.y?s.cubeRotate(2,!1):l>u.x&&a>h.y&&a<u.y?s.cubeRotate(2,!0):l<p.x&&a>p.y&&a<m.y?s.cubeRotate(1,!0):l>d.x&&a>d.y&&a<h.y?s.cubeRotate(1,!1):a<p.y&&l>p.x&&l<d.x&&s.cubeRotate(0,!1)}onPointerMove(t,e){this.numOfPointerMoves++,this.xOnMove=t,this.yOnMove=e}onPointerUp(t,e,n){if(this.numOfPointerMoves<2)return;let s,o;if(this.stickerOnDown!==-1&&(s=pe(this.cart2dOnDown[0],this.cart2dOnDown[1],this.cart2dOnDown[4],this.cart2dOnDown[5]),o=pe(this.cart2dOnDown[2],this.cart2dOnDown[3],this.cart2dOnDown[6],this.cart2dOnDown[7]),s<0)){let c=s;s=o,o=c}let l=De(this.xOnMove,t.clientWidth),a=Fe(this.yOnMove,t.clientHeight),i=pe(l,a,this.xOnDown,this.yOnDown);e.stickerIsOnFace(this.stickerOnDown,0)?l===this.xOnDown?e.turn(0,ye(e,this.stickerOnDown),a>this.yOnDown):i>s?e.turn(0,ye(e,this.stickerOnDown),l>this.xOnDown):i<o?e.turn(0,ye(e,this.stickerOnDown),l<this.xOnDown):e.turn(2,Yt(e,this.stickerOnDown),l>this.xOnDown):e.stickerIsOnFace(this.stickerOnDown,1)&&(l===this.xOnDown?e.turn(0,ge(e,this.stickerOnDown),a>this.yOnDown):i>s?e.turn(0,ge(e,this.stickerOnDown),l>this.xOnDown):i<o?e.turn(0,ge(e,this.stickerOnDown),l<this.xOnDown):e.turn(1,zt(e,this.stickerOnDown),l<this.xOnDown))}_coordinatesToSticker(t,e,n,s){let o=l=>{if(!s[l].cart2d){console.error("cart2d is undefined");return}let a=s[l].cart2d,i=X(a[0],a[1],a[2],a[3],a[4],a[5])+X(a[0],a[1],a[4],a[5],a[6],a[7]),c=X(t,e,a[0],a[1],a[2],a[3])+X(t,e,a[2],a[3],a[4],a[5])+X(t,e,a[4],a[5],a[6],a[7])+X(t,e,a[6],a[7],a[0],a[1]),u=1e-5;if(Math.abs(i-c)<u)return[l,a]};for(let l=0;l<2*f(n.layers);l++){let a=o(l);if(a)return a}return[-1,void 0]}};function ee(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function we(r,t,e,n,s){let o=1/Math.tan(t/2);if(r[0]=o/e,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,s!=null&&s!==1/0){let l=1/(n-s);r[10]=(s+n)*l,r[14]=2*s*n*l}else r[10]=-1,r[14]=-2*n;return r}function te(r,t,e,n){let s=n[0],o=n[1],l=n[2],a=1/Math.hypot(s,o,l);s*=a,o*=a,l*=a;let i=Math.sin(e),c=Math.cos(e),u=1-c,m=t[0],h=t[1],p=t[2],d=t[3],b=t[4],L=t[5],k=t[6],B=t[7],R=t[8],S=t[9],A=t[10],z=t[11],O=s*s*u+c,I=o*s*u+l*i,D=l*s*u-o*i,F=s*o*u-l*i,w=o*o*u+c,_=l*o*u+s*i,T=s*l*u+o*i,M=o*l*u-s*i,U=l*l*u+c;return r[0]=m*O+b*I+R*D,r[1]=h*O+L*I+S*D,r[2]=p*O+k*I+A*D,r[3]=d*O+B*I+z*D,r[4]=m*F+b*w+R*_,r[5]=h*F+L*w+S*_,r[6]=p*F+k*w+A*_,r[7]=d*F+B*w+z*_,r[8]=m*T+b*M+R*U,r[9]=h*T+L*M+S*U,r[10]=p*T+k*M+A*U,r[11]=d*T+B*M+z*U,t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r}function _e(r,t){let e=t[0],n=t[1],s=t[2];return r[12]+=r[0]*e+r[4]*n+r[7]*s,r[13]+=r[1]*e+r[5]*n+r[8]*s,r[14]+=r[2]*e+r[5]*n+r[9]*s,r[15]+=r[3]*e+r[6]*n+r[10]*s,r}function be(){let r;return t=>(r||(r=t()),r)}var P=document.querySelector("canvas"),g=P.getContext("webgl"),j=Xt(),Y=[],re={animateTurns:!0,hintStickers:!0,showBody:!0};var Ue=Date.now()*.001,Vt=3,He=!1;function qe(){He||(He=!0,requestAnimationFrame(Ke))}function Ge(r){let t=document.querySelector(r),e=new ie,n=new le,s=Zt(t),o=new ce;e.setNumOfLayers(Vt);let l=ae(g,e,s),a={div:t,cube:e,spring:n,buffers:l,perspectiveMatrix:s},i=(d,b)=>{!a.dragEnabled||o.onPointerDown(d,b,a.div,a.cube,a.buffers)},c=(d,b)=>{!a.dragEnabled||o.onPointerMove(d,b)},u=()=>{!a.dragEnabled||o.onPointerUp(a.div,a.cube,a.buffers)},m=d=>{let b=d.target.getBoundingClientRect(),L=d.touches[0].pageX-b.left,k=d.touches[0].pageY-b.top;return{x:L,y:k}},h=()=>{t.addEventListener("pointerdown",d=>i(d.offsetX,d.offsetY)),t.addEventListener("pointermove",d=>c(d.offsetX,d.offsetY)),t.addEventListener("pointerup",d=>u())},p=()=>{t.addEventListener("touchstart",d=>{let{x:b,y:L}=m(d);i(b,L)}),t.addEventListener("touchmove",d=>{let{x:b,y:L}=m(d);c(b,L)}),t.addEventListener("touchend",d=>{u()})};return window.PointerEvent?h():p(),a}function Xt(){let e=Jt(g,`
    attribute vec4 aVertexPosition;
    attribute vec4 aVertexColor;
    uniform mat4 uTransformMatrix;
    uniform mat4 uRotateMatrix;

    // variables shared between vertex and fragment shaders
    varying lowp vec4 vColor;
    varying lowp vec4 originalPos;
    varying lowp vec4 rotatedPos;
    void main(void) {
        gl_Position = uTransformMatrix * aVertexPosition;
        originalPos = aVertexPosition;
        rotatedPos = uRotateMatrix * aVertexPosition;
        vColor = aVertexColor;
    }
    `,`
    // variables shared between vertex and fragment shaders
    varying lowp vec4 vColor;
    varying lowp vec4 originalPos;
    varying lowp vec4 rotatedPos;

    void main(void) {
        gl_FragColor = vColor;

        // low precision float variable
        lowp float max = 1.05;

        // if it is a normal sticker rather than a hint sticker, it should not be discarded
        if (originalPos.x < max && originalPos.x > -max && originalPos.y < max && originalPos.y > -max && originalPos.z < max && originalPos.z > -max) {
            return;
        }

        // if it starts on the right or left, and stays on its side, it should not be discarded
        if (originalPos.x > max && rotatedPos.x > max) return;
        if (originalPos.x < -max && rotatedPos.x < -max) return;

        if (rotatedPos.y < max && rotatedPos.z < max) return;
        discard;
    }
    `);return g.useProgram(e),{attribLocations:{vertexPosition:g.getAttribLocation(e,"aVertexPosition"),vertexColor:g.getAttribLocation(e,"aVertexColor")},uniformLocations:{transformMatrix:g.getUniformLocation(e,"uTransformMatrix"),rotateMatrix:g.getUniformLocation(e,"uRotateMatrix")}}}function Zt(r){let t=ee();return we(t,50*Math.PI/180,r.clientWidth/r.clientHeight,.1,100),_e(t,[0,0,-5]),te(t,t,45*Math.PI/180,[1,0,0]),te(t,t,0,[0,-1,0]),t}function xe(r,t,e){e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribPointer(t.attribLocations.vertexPosition,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(t.attribLocations.vertexPosition)}function Se(r,t,e){e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribPointer(t.attribLocations.vertexColor,4,e.FLOAT,!1,0,0),e.enableVertexAttribArray(t.attribLocations.vertexColor)}function ke(r){r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0)}function Jt(r,t,e){let n=We(r,r.VERTEX_SHADER,t),s=We(r,r.FRAGMENT_SHADER,e),o=r.createProgram();return r.attachShader(o,n),r.attachShader(o,s),r.linkProgram(o),r.getProgramParameter(o,r.LINK_STATUS)?o:(alert("Unable to initialize the shader program: "+r.getProgramInfoLog(o)),null)}function We(r,t,e){let n=r.createShader(t);return r.shaderSource(n,e),r.compileShader(n),r.getShaderParameter(n,r.COMPILE_STATUS)?n:(alert("An error occurred compiling the shaders: "+r.getShaderInfoLog(n)),r.deleteShader(n),null)}function er(){let r=P.clientWidth,t=P.clientHeight,e=P.width!==r||P.height!==t;return e&&(P.width=r,P.height=t),e}function Ke(r){r*=.001;let t=r-Ue;Ue=r,er(),g.enable(g.DEPTH_TEST),g.enable(g.SCISSOR_TEST),g.depthFunc(g.LEQUAL),g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT),P.style.transform=`translateY(${window.scrollY}px)`;for(let e=0;e<Y.length;e++){let{cube:n,div:s,spring:o,buffers:l,perspectiveMatrix:a}=Y[e],i=s.getBoundingClientRect();if(i.bottom<0||i.top>P.clientHeight||i.right<0||i.left>P.clientWidth)continue;let c=i.right-i.left,u=i.bottom-i.top,m=i.left,h=P.clientHeight-i.bottom;g.viewport(m,h,c,u),g.scissor(m,h,c,u),n.animationQueue[0]&&(o.target=n.animationQueue.length*90,o.update(t),o.position>=90&&(n.affectedStickers=Array(v(n.layers)).fill(!1),o.position=0,n.animationQueue.shift()));let p=n.animationQueue[0],d=tr(n),b=be(),L=be();for(let k=0;k<v(n.layers);k++){let B=l[k],R=p&&p.stickersToAnimate[k]&&re.animateTurns?b(()=>te(ee(),a,o.position*Math.PI/180,p.axis)):a;g.uniformMatrix4fv(j.uniformLocations.transformMatrix,!1,R);let S=p&&p.stickersToAnimate[k]&&re.animateTurns?L(()=>{let A=ee();return te(A,A,o.position*Math.PI/180,p.axis)}):ee();g.uniformMatrix4fv(j.uniformLocations.rotateMatrix,!1,S),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,B.indexBuffer),re.showBody&&(xe(B.noGapPositionBuffer,j,g),Se(n.underStickers[k].buffer,j,g),ke(g)),xe(B.positionBuffer,j,g),Se(d[k].buffer,j,g),ke(g),re.hintStickers&&(xe(B.hintPositionBuffer,j,g),Se(d[k].buffer,j,g),ke(g))}}requestAnimationFrame(Ke)}function tr(r){return re.animateTurns&&r.animationQueue[0]?r.animationQueue[0].stickers:r.stickers}var ne=725,ve=!1;function Le(r){ve=!0,r.style.display="flex",r.classList.add("slideLeftOpen"),document.documentElement.clientWidth<ne?r.classList.add("slideLeftClosed"):r.classList.remove("slideLeftClosed")}function ue(r){ve=!1,document.documentElement.clientWidth<ne?(r.classList.add("slideLeftClosed"),r.classList.remove("slideLeftOpen"),r.style.display="flex"):r.style.display="none"}function Te(r){ve?ue(r):Le(r)}function Ne(){let r=document.querySelector(".slideRight"),t=!1;function e(n){if(t=n,t){r.classList.add("slideRightOpen");return}r.classList.remove("slideRightOpen")}document.addEventListener("click",n=>{let s=n.target;if(s===document.querySelector("#menu")){e(!0);return}t&&!s.closest(".slideRight")&&e(!1)}),document.querySelector("#closeMenu").addEventListener("click",()=>{e(!1)}),document.querySelector("#learnButton").addEventListener("click",()=>{document.location.href="learn.html"}),document.querySelector("#playButton").addEventListener("click",()=>{document.location.href="play.html"}),document.querySelector("#trainButton").addEventListener("click",()=>{document.location.href="train.html"}),document.querySelector("#cubleButton").addEventListener("click",()=>{document.location.href="cuble.html"})}var nr=document.querySelector("canvas"),sr=nr.getContext("webgl");function je(r,t){Ne(),ir(r,t),or(r);for(let e=0;e<r.length;e++)Ye(r,t,e);se(r),qe(),ar(),Ve()}function Ye(r,t,e){let n=Ge(`#scene${e}`);Y.push(n),n.cube.setNumOfLayers(t),n.buffers=ae(sr,Y[0].cube,Y[0].perspectiveMatrix);let s=r[e];if(s.cube=n.cube,s.move=0,s.practiceProblems)n.dragEnabled=!0,ze(s);else{let o=Qe(s);n.cube.setColors(o),n.cube.execAlg(s.setup)}}function se(r){for(let t=0;t<r.length;t++){let e=r[t];if(e.practiceProblems&&e.showSolution){let o=e.practiceProblems[e.problemIndex];document.querySelector(`#problemText${t}`).textContent=o.explanation,document.querySelector(`#leftButton${t}`).style.display="",document.querySelector(`#rightButton${t}`).style.display="";let l=document.querySelector(`#moveCounter${t}`);l.style.display="";let a=he(e.algorithm);l.textContent=`${e.move} / ${a.length}`;continue}if(e.practiceProblems&&!e.showSolution){let o=e.practiceProblems[e.problemIndex];document.querySelector(`#problemText${t}`).textContent=o.directions,document.querySelector(`#leftButton${t}`).style.display="none",document.querySelector(`#rightButton${t}`).style.display="none",document.querySelector(`#moveCounter${t}`).style.display="none";continue}let n=document.querySelector(`#moveCounter${t}`),s=he(e.algorithm);n.textContent=`${e.move} / ${s.length}`}}function ze(r){let t=C(r.practiceProblems.length);for(;t===r.problemIndex;)t=C(r.practiceProblems.length);$e(r,t)}function $e(r,t){let e=r.practiceProblems[t];r.problemIndex=t,r.algorithm=r.practiceProblems[t].algorithm;let n=Qe(r);r.cube.setColors(n),r.cube.execAlg(e.setup),r.move=0}function Qe(r){let t=Array(54);r.activeStickers.forEach(e=>{t[e]=Z(J(e,r.cube))});for(let e=0;e<54;e++)t[e]||(t[e]=Ae);return t}function ir(r,t){let e=document.querySelector("#lessonNavigator");e.addEventListener("click",n=>{let s=n.target;if(s.className==="lesson-p"){let o=parseInt(s.getAttribute("lesson-index"));Ye(r,t,o),document.documentElement.clientWidth<ne&&ue(e)}}),document.querySelector("#openClose").addEventListener("click",n=>{Te(e)}),document.querySelector("#close").addEventListener("click",n=>{Te(e)})}function or(r){let t="leftButton",e="rightButton",n="showSolution",s="next";document.addEventListener("click",o=>{let l=o.target;if(l.id.startsWith(t)){let a=parseInt(l.id.substring(t.length)),i=r[a];if(i.move<=0)return;i.move--;let c=he(i.algorithm);i.cube.stepAlgorithm(c[i.move],!1),se(r)}else if(l.id.startsWith(e)){let a=parseInt(l.id.substring(e.length)),i=r[a],c=he(i.algorithm);if(i.move>=c.length)return;i.cube.stepAlgorithm(c[i.move],!0),i.move++,se(r)}else if(l.id.startsWith(n)){let a=parseInt(l.id.substring(n.length)),i=r[a];i.showSolution=!0,Y[a].dragEnabled=!1,$e(i,i.problemIndex),se(r)}else if(l.id.startsWith(s)){let a=parseInt(l.id.substring(s.length)),i=r[a];i.showSolution=!1,Y[a].dragEnabled=!0,ze(i),se(r)}})}function ar(){window.addEventListener("resize",()=>{Ve()})}function Ve(){let r=document.querySelector("#openClose"),t=document.querySelector("#close"),e=document.querySelector("#lessonNavigator");if(document.documentElement.clientWidth<ne){r.style.display="inline-block",t.style.display="inline-block",ue(e);return}r.style.display="none",t.style.display="none",Le(e)}function he(r){return(r||"").split(" ")}var lr=[{activeStickers:y,setup:"U'",algorithm:"U"},{activeStickers:y,setup:"U",algorithm:"U'"},{activeStickers:y,setup:"D'",algorithm:"D"},{activeStickers:y,setup:"D",algorithm:"D'"},{activeStickers:y,setup:"R'",algorithm:"R"},{activeStickers:y,setup:"R",algorithm:"R'"},{activeStickers:y,setup:"L'",algorithm:"L"},{activeStickers:y,setup:"L",algorithm:"L'"},{activeStickers:y,setup:"F'",algorithm:"F"},{activeStickers:y,setup:"F",algorithm:"F'"},{activeStickers:y,setup:"B'",algorithm:"B"},{activeStickers:y,setup:"B",algorithm:"B'"},{activeStickers:y,setup:"B2 F2 L2 R2 D2 U2",algorithm:"U U D D R R L L F F B B"},{activeStickers:y,setup:"u'",algorithm:"u"},{activeStickers:y,setup:"d'",algorithm:"d"},{activeStickers:y,setup:"r'",algorithm:"r"},{activeStickers:y,setup:"l'",algorithm:"l"},{activeStickers:y,setup:"f'",algorithm:"f"},{activeStickers:y,setup:"b'",algorithm:"b"},{activeStickers:y,setup:"M'",algorithm:"M"},{activeStickers:y,setup:"M",algorithm:"M'"},{activeStickers:y,setup:"E'",algorithm:"E"},{activeStickers:y,setup:"E",algorithm:"E'"},{activeStickers:y,setup:"S'",algorithm:"S"},{activeStickers:y,setup:"S",algorithm:"S'"},{activeStickers:y,setup:"x'",algorithm:"x"},{activeStickers:y,setup:"x",algorithm:"x'"},{activeStickers:y,setup:"y'",algorithm:"y"},{activeStickers:y,setup:"y",algorithm:"y'"},{activeStickers:y,setup:"z'",algorithm:"z"},{activeStickers:y,setup:"z",algorithm:"z'"},{activeStickers:y,setup:"R U R' F' R U R' U' R' F R2 U' R' U'",algorithm:"R U R' F' R U R' U' R' F R2 U' R' U'"}];function cr(){je(lr,3)}cr();})();
//# sourceMappingURL=learnNotation.js.map
