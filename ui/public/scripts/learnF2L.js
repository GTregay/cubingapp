(()=>{var Xt=[1,1,1,1],At=[.5,.5,.5,1],Zt=[1,1,0,1],Jt=[0,1,0,1],te=[0,0,1,1],ee=[1,.5,0,1],re=[1,0,0,1],Et=[0,0,0,1],Tt=[Xt,Jt,Zt,te,ee,re];function Z(r){return(r<0||r>=Tt.length)&&console.error("Invalid face: "+r),Tt[r]}function J(r,e){return Math.floor(r/f(e.layers))}function P(r){return Math.floor(Math.random()*r)}function Bt(r){let e=r.length;for(;e!=0;){let t=P(e);e--;let n=r[t];r[t]=r[e],r[e]=n}return r}var H=0,W=1,q=2,G=3,K=4,z=5,ne=[[H,G,K],[H,z,G],[H,K,W],[H,W,z],[q,W,K],[q,z,W],[q,K,G],[q,G,z]],se=[[H,G],[H,K],[H,z],[H,W],[W,K],[W,z],[q,W],[q,K],[q,z],[q,G],[G,K],[G,z]];function Ot(r){let e=Ct(12,2),t=Ct(8,3),n=mt(8),s=mt(12);for(;Pt(n)!==Pt(s);)n=mt(8);let o=Array(54);for(let g=0;g<6;g++){let T=r.center(g);o[T]=g}let l=r.corners(0,0),a=r.corners(1,0),i=r.corners(2,0),c=r.corners(3,0),u=r.corners(4,0),m=r.corners(5,0),h=(g,T,Y,O,U,D,F,w,_)=>{let k=(C,I)=>ne[n[C]][(t[C]+I)%3];o[g.topLeft]=k(T,D),o[g.topRight]=k(Y,F),o[g.bottomLeft]=k(O,w),o[g.bottomRight]=k(U,_)};h(l,0,1,2,3,0,0,0,0),h(a,2,3,4,5,2,1,1,2),h(i,4,5,6,7,0,0,0,0),h(c,6,7,0,1,2,1,1,2),h(u,0,2,6,4,2,1,1,2),h(m,3,1,5,7,2,1,1,2);let y=r.edges(0,0,0),d=r.edges(1,0,0),b=r.edges(2,0,0),L=r.edges(3,0,0),R=r.edges(4,0,0),B=r.edges(5,0,0),v=(g,T,Y,O,U,D,F,w,_)=>{let k=(C,I)=>se[s[C]][(e[C]+I)%2];o[g.top]=k(T,D),o[g.left]=k(Y,F),o[g.right]=k(O,w),o[g.bottom]=k(U,_)};return v(y,0,1,2,3,0,0,0,0),v(d,3,4,5,6,1,0,0,1),v(b,6,7,8,9,0,0,0,0),v(L,9,10,11,0,1,0,0,1),v(R,1,10,4,7,1,1,1,1),v(B,2,5,11,8,1,1,1,1),o}function Ct(r,e){let t=Array(r);for(let n=0;n<r;n++)t[n]=P(e);for(;!ie(t,e);){let n=P(r);t[n]=P(e)}return t}function ie(r,e){let t=0;for(let n=0;n<r.length;n++)t+=r[n];return t%e===0}function mt(r){let e=Array(r);for(let t=0;t<r;t++)e[t]=t;return Bt(e),e}function Pt(r){let e=[...r],t=!1;for(;;)if(e[0]===0){let n=e.findIndex((s,o)=>s!==o);if(n===-1)return t;e[0]=e[n],e[n]=0,t=!t}else{let n=e[0];e[0]=e[n],e[n]=n,t=!t}}var oe=document.querySelector("canvas"),$=oe.getContext("webgl");function ft(r,e){let t=[e[0],e[1],e[2],e[3],e[0],e[1],e[2],e[3],e[0],e[1],e[2],e[3],e[0],e[1],e[2],e[3]];$.bindBuffer($.ARRAY_BUFFER,r.buffer),$.bufferData($.ARRAY_BUFFER,new Float32Array(t),$.STATIC_DRAW)}function f(r){return r*r}function x(r){return Math.floor(r/2)}function Q(r){return r%2==0}function S(r){return r*r*6}var it=class{constructor(){this.animationQueue=[]}setColors(e){for(let t=0;t<S(this.layers);t++)ft(this.stickers[t],e[t])}solve(){let e=Array(S(this.layers));for(let t=0;t<S(this.layers);t++){let n=J(t,this);this.stickers[t].face=n,e[t]=Z(n)}this.setColors(e)}scramble(){if(this.layers===3){this.scramble3x3();return}this.naiveScramble()}scramble3x3(){let e=Ot(this);this.setCubeState(e)}naiveScramble(){let e=f(this.layers)*10;for(let t=0;t<e;t++){let n=Math.floor(Math.random()*3),s=Math.floor(Math.random()*this.layers),o=Math.floor(Math.random()*1)==0;this._matchTurn(n,s,o)}}setNumOfLayers(e){this.layers=e,this.stickers=Array(S(e)),this.underStickers=Array(S(e));for(let t=0;t<S(e);t++){let n=J(t,this);this.stickers[t]={face:n,buffer:$.createBuffer()},this.underStickers[t]={face:n,buffer:$.createBuffer()},ft(this.underStickers[t],Et)}this.affectedStickers=Array(S(e)).fill(!1)}getCubeState(){return this.stickers.map(e=>e.face)}setCubeState(e){for(let t=0;t<S(this.layers);t++){let n=Z(e[t]);this.stickers[t].face=e[t],ft(this.stickers[t],n)}}resetAffectedStickers(){let e=Array(S(this.layers));this.affectedStickers=e.fill(this.layers===1)}pushAnimation(e,t,n){let s=t?-1:1,o=[0,0,0];o[e]=s,this.animationQueue.push({axis:o,stickers:n,stickersToAnimate:this.affectedStickers})}turn(e,t,n){this.resetAffectedStickers(),this.pushAnimation(e,n,[...this.stickers]),this._matchTurn(e,t,n)}sliceTurn(e,t){let n=Array(S(this.layers));this.affectedStickers=n.fill(!1),this.pushAnimation(e,t,[...this.stickers]);for(let s=1;s<this.layers-1;s++)this._matchTurn(e,s,t)}wideTurn(e,t,n){this.resetAffectedStickers(),this.pushAnimation(e,n,[...this.stickers]),this._matchTurn(e,t,n);for(let s=1;s<this.layers-1;s++)this._matchTurn(e,s,n)}cubeRotate(e,t){this.resetAffectedStickers(),this.pushAnimation(e,t,[...this.stickers]);for(let n=0;n<this.layers;n++)this._matchTurn(e,n,t)}_matchTurn(e,t,n){e==0?(this._turnXAxis(t,n),t==0?this._turnOuter(5,n):t==this.layers-1&&this._turnOuter(4,!n)):e==1?(this._turnYAxis(t,n),t==0?this._turnOuter(0,n):t==this.layers-1&&this._turnOuter(2,!n)):e==2?(this._turnZAxis(t,n),t==0?this._turnOuter(1,n):t==this.layers-1&&this._turnOuter(3,!n)):console.error(`Axis ${e} not recognized`)}_turnXAxis(e,t){for(let n=1;n<=this.layers;n++)this._cycle(t,0*f(this.layers)+f(this.layers)-n-e*this.layers,3*f(this.layers)+f(this.layers)-n-e*this.layers,2*f(this.layers)+f(this.layers)-n-e*this.layers,1*f(this.layers)+f(this.layers)-n-e*this.layers)}_turnYAxis(e,t){for(let n=0;n<this.layers;n++)this._cycle(t,1*f(this.layers)+n*this.layers+e,4*f(this.layers)+n*this.layers+e,3*f(this.layers)+(this.layers-n-1)*this.layers+(this.layers-1)-e,5*f(this.layers)+n*this.layers+e)}_turnZAxis(e,t){for(let n=0;n<this.layers;n++)this._cycle(t,0*f(this.layers)+(n+1)*this.layers-1-e,5*f(this.layers)+n+this.layers*e,2*f(this.layers)+(this.layers-n-1)*this.layers+e,4*f(this.layers)+f(this.layers)-(n+1)-e*this.layers)}_turnOuter(e,t){if(this.layers%2!=0){let n=this.center(e);this.affectedStickers[n]=!0}for(let n=0;n<Math.floor(this.layers/2);n++){let{topLeft:s,topRight:o,bottomLeft:l,bottomRight:a}=this.corners(e,n);this._cycle(t,s,o,a,l);let i=this.layers-2*(n+1);for(let c=0;c<i;c++){let{top:u,left:m,bottom:h,right:y}=this.edges(e,n,c);this._cycle(t,u,y,h,m)}}}_cycle(e,t,n,s,o){this.affectedStickers[t]=!0,this.affectedStickers[n]=!0,this.affectedStickers[s]=!0,this.affectedStickers[o]=!0,e?this._cycleHelper(t,n,s,o):this._cycleHelper(o,s,n,t)}_cycleHelper(e,t,n,s){let o=this.stickers[s];this.stickers[s]=this.stickers[n],this.stickers[n]=this.stickers[t],this.stickers[t]=this.stickers[e],this.stickers[e]=o}matchKeyToTurn(e){if(this.disableTurn||e.ctrlKey)return;switch(e.code){case"KeyN":return this.cubeRotate(0,!0),{notation:"x",rotate:!0};case"KeyB":return this.cubeRotate(0,!1),{notation:"x'",rotate:!0};case"Semicolon":return this.cubeRotate(1,!0),{notation:"y",rotate:!0};case"KeyA":return this.cubeRotate(1,!1),{notation:"y'",rotate:!0};case"KeyP":return this.cubeRotate(2,!0),{notation:"z",rotate:!0};case"KeyQ":return this.cubeRotate(2,!1),{notation:"z'",rotate:!0};case"KeyJ":return this.turn(1,0,!0),{notation:"U",turn:!0};case"KeyF":return this.turn(1,0,!1),{notation:"U'",turn:!0};case"KeyS":return this.turn(1,this.layers-1,!1),{notation:"D",turn:!0};case"KeyL":return this.turn(1,this.layers-1,!0),{notation:"D'",turn:!0};case"KeyH":return this.turn(2,0,!0),{notation:"F",turn:!0};case"KeyG":return this.turn(2,0,!1),{notation:"F'",turn:!0};case"KeyW":return this.turn(2,this.layers-1,!1),{notation:"B",turn:!0};case"KeyO":return this.turn(2,this.layers-1,!0),{notation:"B'",turn:!0};case"KeyD":return this.turn(0,this.layers-1,!1),{notation:"L",turn:!0};case"KeyE":return this.turn(0,this.layers-1,!0),{notation:"L'",turn:!0};case"KeyI":return this.turn(0,0,!0),{notation:"R",turn:!0};case"KeyK":return this.turn(0,0,!1),{notation:"R'",turn:!0};case"BracketLeft":return this.sliceTurn(0,!1),{notation:"M",turn:!0};case"Quote":return this.sliceTurn(0,!0),{notation:"M'",turn:!0};case"KeyC":return this.sliceTurn(1,!1),{notation:"E",turn:!0};case"Comma":return this.sliceTurn(1,!0),{notation:"E'",turn:!0};case"KeyY":return this.sliceTurn(2,!0),{notation:"S",turn:!0};case"KeyT":return this.sliceTurn(2,!1),{notation:"S'",turn:!0};case"KeyU":return this.wideTurn(0,0,!0),{notation:"r",turn:!0};case"KeyM":return this.wideTurn(0,0,!1),{notation:"r'",turn:!0};case"KeyV":return this.wideTurn(0,this.layers-1,!1),{notation:"l",turn:!0};case"KeyR":return this.wideTurn(0,this.layers-1,!0),{notation:"l'",turn:!0}}}stepAlgorithm(e,t){switch(e){case"x":this.cubeRotate(0,t);break;case"x'":this.cubeRotate(0,!t);break;case"x2":case"x2'":this.cubeRotate(0,t),this.cubeRotate(0,t);break;case"y":this.cubeRotate(1,t);break;case"y'":this.cubeRotate(1,!t);break;case"y2":case"y2'":this.cubeRotate(1,t),this.cubeRotate(1,t);break;case"z":this.cubeRotate(2,t);break;case"z'":this.cubeRotate(2,!t);break;case"z2":case"z2'":this.cubeRotate(2,t),this.cubeRotate(2,t);break;case"U":this.turn(1,0,t);break;case"U'":this.turn(1,0,!t);break;case"U2":case"U2'":this.turn(1,0,t),this.turn(1,0,t);break;case"u":this.wideTurn(1,0,t);break;case"u'":this.wideTurn(1,0,!t);break;case"u2":case"u2'":this.wideTurn(1,0,t),this.wideTurn(1,0,t);break;case"D":this.turn(1,this.layers-1,!t);break;case"D'":this.turn(1,this.layers-1,t);break;case"D2":case"D2'":this.turn(1,this.layers-1,t),this.turn(1,this.layers-1,t);break;case"d":this.wideTurn(1,this.layers-1,!t);break;case"d'":this.wideTurn(1,this.layers-1,t);break;case"d2":case"d2'":this.wideTurn(1,this.layers-1,t),this.wideTurn(1,this.layers-1,t);break;case"F":this.turn(2,0,t);break;case"F'":this.turn(2,0,!t);break;case"F2":case"F2'":this.turn(2,0,t),this.turn(2,0,t);break;case"f":this.wideTurn(2,0,t);break;case"f'":this.wideTurn(2,0,!t);break;case"f2":case"f2'":this.wideTurn(2,0,t),this.wideTurn(2,0,t);break;case"B":this.turn(2,this.layers-1,!t);break;case"B'":this.turn(2,this.layers-1,t);break;case"B2":case"B2'":this.turn(2,this.layers-1,t),this.turn(2,this.layers-1,t);break;case"b":this.wideTurn(2,this.layers-1,!t);break;case"b'":this.wideTurn(2,this.layers-1,t);break;case"b2":case"b2'":this.wideTurn(2,this.layers-1,t),this.wideTurn(2,this.layers-1,t);break;case"L":this.turn(0,this.layers-1,!t);break;case"L'":this.turn(0,this.layers-1,t);break;case"L2":case"L2'":this.turn(0,this.layers-1,t),this.turn(0,this.layers-1,t);break;case"l":this.wideTurn(0,this.layers-1,!t);break;case"l'":this.wideTurn(0,this.layers-1,t);break;case"l2":case"l2'":this.wideTurn(0,this.layers-1,t),this.wideTurn(0,this.layers-1,t);break;case"R":this.turn(0,0,t);break;case"R'":this.turn(0,0,!t);break;case"R2":case"R2'":this.turn(0,0,t),this.turn(0,0,t);break;case"r":this.wideTurn(0,0,t);break;case"r'":this.wideTurn(0,0,!t);break;case"r2":case"r2'":this.wideTurn(0,0,t),this.wideTurn(0,0,t);break;case"M":this.turn(0,1,!t);break;case"M'":this.turn(0,1,t);break;case"M2":case"M2'":this.sliceTurn(0,t),this.sliceTurn(0,t);break;case"E":this.sliceTurn(1,!t);break;case"E'":this.sliceTurn(1,t);break;case"E2":case"E2'":this.sliceTurn(1,t),this.sliceTurn(1,t);break;case"S":this.sliceTurn(2,t);break;case"S'":this.sliceTurn(2,!t);break;case"S2":case"S2'":this.sliceTurn(2,t);default:throw new Error("Invalid turn in algorithm: "+e)}}execAlg(e){if(!e)return;let t=e.split(" ");for(let n=0;n<t.length;n++)this.stepAlgorithm(t[n],!0);this.animationQueue=[]}execAlgReverse(e){if(!e)return;let t=e.split(" ");for(let n=t.length-1;n>=0;n--)this.stepAlgorithm(t[n],!1);this.animationQueue=[]}stickerIsOnFace(e,t){return t*f(this.layers)<=e&&e<(t+1)*f(this.layers)}center(e){return e*f(this.layers)+Math.floor(f(this.layers)/2)}corners(e,t){let n=e*f(this.layers);return{topLeft:n+(this.layers+1)*t,topRight:n+(this.layers-1)*(this.layers-t),bottomRight:n+(this.layers+1)*(this.layers-t-1),bottomLeft:n+(this.layers-1)*(t+1)}}edges(e,t,n){let s=this.corners(e,t),o=this.layers-2*(t+1);return{top:s.topLeft+this.layers*(n+1),left:s.topLeft+(o-n),right:s.topRight+n+1,bottom:s.bottomLeft+this.layers*(o-n)}}};function at(r,e,t){let n=dt(e,1.01,.02),s=dt(e,1,0),o=dt(e,1.5,.02),l=Array(S(e.layers));for(let a=0;a<S(e.layers);a++){let i={positionBuffer:r.createBuffer(),noGapPositionBuffer:r.createBuffer(),hintPositionBuffer:r.createBuffer(),indexBuffer:r.createBuffer(),cart2d:[],positions:null},c=new Float32Array(12),u=new Float32Array(12),m=new Float32Array(12);for(let d=0;d<12;d++){let b=a*12+d;c[d]=n[b],u[d]=s[b],m[d]=o[b]}r.bindBuffer(r.ARRAY_BUFFER,i.positionBuffer),r.bufferData(r.ARRAY_BUFFER,c,r.STATIC_DRAW),i.positions=c,r.bindBuffer(r.ARRAY_BUFFER,i.noGapPositionBuffer),r.bufferData(r.ARRAY_BUFFER,u,r.STATIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,i.hintPositionBuffer),r.bufferData(r.ARRAY_BUFFER,m,r.STATIC_DRAW);let h=Array(16);ot(h,0,t,[u[0],u[1],u[2],1]),ot(h,4,t,[u[3],u[4],u[5],1]),ot(h,8,t,[u[6],u[7],u[8],1]),ot(h,12,t,[u[9],u[10],u[11],1]),i.cart2d=[h[0]/h[3],h[1]/h[3],h[4]/h[7],h[5]/h[7],h[8]/h[11],h[9]/h[11],h[12]/h[15],h[13]/h[15]];let y=[0,1,2,0,2,3];r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i.indexBuffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,new Uint16Array(y),r.STATIC_DRAW),l[a]=i}return l}function ot(r,e,t,n){let s=Array(4),o=n[0],l=n[1],a=n[2],i=n[3];r[e+0]=o*t[0]+l*t[4]+a*t[8]+i*t[12],r[e+1]=o*t[1]+l*t[5]+a*t[9]+i*t[13],r[e+2]=o*t[2]+l*t[6]+a*t[10]+i*t[14],r[e+3]=o*t[3]+l*t[7]+a*t[11]+i*t[15]}var Ut=12,ae=4,V=3;function dt(r,e,t){let n=f(r.layers)*Ut,s=Array(6*n);return le(s,0*n,r,1,e,t),ce(s,1*n,r,0,e,t),ue(s,2*n,r,1,-e,t),he(s,3*n,r,0,-e,t),me(s,4*n,r,2,-e,t),fe(s,5*n,r,2,e,t),s}function le(r,e,t,n,s,o){if(Q(t.layers)){let i=Array(f(t.layers)),c=0;for(let u=0;u<t.layers;u++)for(let m=0;m<t.layers;m++){let h=-1+1/t.layers+m*2/t.layers,y=-1+1/t.layers+u*2/t.layers;i[c]=[h,y,s],c++}A(r,e,t,i,n,o);return}let l=Array(f(t.layers)),a=0;for(let i=-x(t.layers);i<=x(t.layers);i++)for(let c=-x(t.layers);c<=x(t.layers);c++)l[a]=[2*c/t.layers,2*i/t.layers,s],a++;A(r,e,t,l,n,o)}function ce(r,e,t,n,s,o){if(Q(t.layers)){let i=Array(f(t.layers)),c=0;for(let u=0;u<t.layers;u++)for(let m=t.layers-1;m>=0;m--){let h=-1+1/t.layers+u*2/t.layers,y=-1+1/t.layers+m*2/t.layers;i[c]=[h,y,s],c++}A(r,e,t,i,n,o);return}let l=Array(f(t.layers)),a=0;for(let i=-x(t.layers);i<=x(t.layers);i++)for(let c=x(t.layers);c>=-x(t.layers);c--)l[a]=[2*i/t.layers,2*c/t.layers,s],a++;A(r,e,t,l,n,o)}function ue(r,e,t,n,s,o){if(Q(t.layers)){let i=Array(f(t.layers)),c=0;for(let u=0;u<t.layers;u++)for(let m=t.layers-1;m>=0;m--){let h=-1+1/t.layers+m*2/t.layers,y=-1+1/t.layers+u*2/t.layers;i[c]=[h,y,s],c++}A(r,e,t,i,n,o);return}let l=Array(f(t.layers)),a=0;for(let i=-x(t.layers);i<=x(t.layers);i++)for(let c=x(t.layers);c>=-x(t.layers);c--)l[a]=[2*c/t.layers,2*i/t.layers,s],a++;A(r,e,t,l,n,o)}function he(r,e,t,n,s,o){if(Q(t.layers)){let i=Array(f(t.layers)),c=0;for(let u=0;u<t.layers;u++)for(let m=0;m<t.layers;m++){let h=-1+1/t.layers+u*2/t.layers,y=-1+1/t.layers+m*2/t.layers;i[c]=[h,y,s],c++}A(r,e,t,i,n,o);return}let l=Array(f(t.layers)),a=0;for(let i=-x(t.layers);i<=x(t.layers);i++)for(let c=-x(t.layers);c<=x(t.layers);c++)l[a]=[2*i/t.layers,2*c/t.layers,s],a++;A(r,e,t,l,n,o)}function me(r,e,t,n,s,o){if(Q(t.layers)){let i=Array(f(t.layers)),c=0;for(let u=0;u<t.layers;u++)for(let m=t.layers-1;m>=0;m--){let h=-1+1/t.layers+m*2/t.layers,y=-1+1/t.layers+u*2/t.layers;i[c]=[h,y,s],c++}A(r,e,t,i,n,o);return}let l=Array(f(t.layers)),a=0;for(let i=-x(t.layers);i<=x(t.layers);i++)for(let c=x(t.layers);c>=-x(t.layers);c--)l[a]=[2*c/t.layers,2*i/t.layers,s],a++;A(r,e,t,l,n,o)}function fe(r,e,t,n,s,o){if(Q(t.layers)){let i=Array(f(t.layers)),c=0;for(let u=t.layers-1;u>=0;u--)for(let m=t.layers-1;m>=0;m--){let h=-1+1/t.layers+m*2/t.layers,y=-1+1/t.layers+u*2/t.layers;i[c]=[h,y,s],c++}A(r,e,t,i,n,o);return}let l=Array(f(t.layers)),a=0;for(let i=x(t.layers);i>=-x(t.layers);i--)for(let c=x(t.layers);c>=-x(t.layers);c--)l[a]=[2*c/t.layers,2*i/t.layers,s],a++;A(r,e,t,l,n,o)}function A(r,e,t,n,s,o){for(let l=0;l<f(t.layers);l++){let a=n[l];de(r,e+l*Ut,t,a[0],a[1],a[2],s,o)}}function de(r,e,t,n,s,o,l,a){let i=1/t.layers-a,c=[[n-i,s-i,o],[n+i,s-i,o],[n+i,s+i,o],[n-i,s+i,o]];for(let u=0;u<ae;u++){let m=c[u];r[e+u*V]=m[(l+0)%V],r[e+u*V+1]=m[(l+1)%V],r[e+u*V+2]=m[(l+2)%V]}}var lt=class{constructor(){this.position=0,this._velocity=200,this._acceleration=0,this.target=0}update(e){let t=-100*(this.position-this.target),n=-15*this._velocity;this._acceleration=t+n,this._velocity+=this._acceleration*e,this.position+=this._velocity*e}};function Dt(r,e){return r/e*2-1}function Ft(r,e){return 1-r/e*2}function yt(r,e,t,n){return r<t?(n-e)/(t-r):(e-n)/(r-t)}function X(r,e,t,n,s,o){return Math.abs(.5*(r*(n-o)+t*(o-e)+s*(e-n)))}function ye(r,e){return r.layers-1-e%r.layers}function pt(r,e){return r.layers-1-Math.floor(e/r.layers)}function pe(r,e){return e%r.layers}function bt(r,e){return r.layers-1-Math.floor((e-f(r.layers))/r.layers)}var ct=class{onPointerDown(e,t,n,s,o){this.numOfPointerMoves=0;let l=Dt(e,n.clientWidth),a=Ft(t,n.clientHeight);this.xOnDown=l,this.yOnDown=a,[this.stickerOnDown,this.cart2dOnDown]=this._coordinatesToSticker(l,a,s,o);function i(b,L,R){return{x:o[b].cart2d[L],y:o[b].cart2d[R]}}if(this.stickerOnDown!==-1)return;let c=i(0,0,1),u=i(s.layers*(s.layers-1),6,7),m=i(s.layers-1,2,3),h=i(f(s.layers)-1,4,5),y=i(s.layers*(s.layers+1)-1,0,1),d=i(f(s.layers)*2-1,2,3);a>c.y&&l>c.x&&l<u.x?s.cubeRotate(0,!0):l<c.x&&a>m.y&&a<c.y?s.cubeRotate(2,!1):l>u.x&&a>h.y&&a<u.y?s.cubeRotate(2,!0):l<y.x&&a>y.y&&a<m.y?s.cubeRotate(1,!0):l>d.x&&a>d.y&&a<h.y?s.cubeRotate(1,!1):a<y.y&&l>y.x&&l<d.x&&s.cubeRotate(0,!1)}onPointerMove(e,t){this.numOfPointerMoves++,this.xOnMove=e,this.yOnMove=t}onPointerUp(e,t,n){if(this.numOfPointerMoves<2)return;let s,o;if(this.stickerOnDown!==-1&&(s=yt(this.cart2dOnDown[0],this.cart2dOnDown[1],this.cart2dOnDown[4],this.cart2dOnDown[5]),o=yt(this.cart2dOnDown[2],this.cart2dOnDown[3],this.cart2dOnDown[6],this.cart2dOnDown[7]),s<0)){let c=s;s=o,o=c}let l=Dt(this.xOnMove,e.clientWidth),a=Ft(this.yOnMove,e.clientHeight),i=yt(l,a,this.xOnDown,this.yOnDown);t.stickerIsOnFace(this.stickerOnDown,0)?l===this.xOnDown?t.turn(0,pt(t,this.stickerOnDown),a>this.yOnDown):i>s?t.turn(0,pt(t,this.stickerOnDown),l>this.xOnDown):i<o?t.turn(0,pt(t,this.stickerOnDown),l<this.xOnDown):t.turn(2,ye(t,this.stickerOnDown),l>this.xOnDown):t.stickerIsOnFace(this.stickerOnDown,1)&&(l===this.xOnDown?t.turn(0,bt(t,this.stickerOnDown),a>this.yOnDown):i>s?t.turn(0,bt(t,this.stickerOnDown),l>this.xOnDown):i<o?t.turn(0,bt(t,this.stickerOnDown),l<this.xOnDown):t.turn(1,pe(t,this.stickerOnDown),l<this.xOnDown))}_coordinatesToSticker(e,t,n,s){let o=l=>{if(!s[l].cart2d){console.error("cart2d is undefined");return}let a=s[l].cart2d,i=X(a[0],a[1],a[2],a[3],a[4],a[5])+X(a[0],a[1],a[4],a[5],a[6],a[7]),c=X(e,t,a[0],a[1],a[2],a[3])+X(e,t,a[2],a[3],a[4],a[5])+X(e,t,a[4],a[5],a[6],a[7])+X(e,t,a[6],a[7],a[0],a[1]),u=1e-5;if(Math.abs(i-c)<u)return[l,a]};for(let l=0;l<2*f(n.layers);l++){let a=o(l);if(a)return a}return[-1,void 0]}};function tt(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function wt(r,e,t,n,s){let o=1/Math.tan(e/2);if(r[0]=o/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,s!=null&&s!==1/0){let l=1/(n-s);r[10]=(s+n)*l,r[14]=2*s*n*l}else r[10]=-1,r[14]=-2*n;return r}function et(r,e,t,n){let s=n[0],o=n[1],l=n[2],a=1/Math.hypot(s,o,l);s*=a,o*=a,l*=a;let i=Math.sin(t),c=Math.cos(t),u=1-c,m=e[0],h=e[1],y=e[2],d=e[3],b=e[4],L=e[5],R=e[6],B=e[7],v=e[8],g=e[9],T=e[10],Y=e[11],O=s*s*u+c,U=o*s*u+l*i,D=l*s*u-o*i,F=s*o*u-l*i,w=o*o*u+c,_=l*o*u+s*i,k=s*l*u+o*i,C=o*l*u-s*i,I=l*l*u+c;return r[0]=m*O+b*U+v*D,r[1]=h*O+L*U+g*D,r[2]=y*O+R*U+T*D,r[3]=d*O+B*U+Y*D,r[4]=m*F+b*w+v*_,r[5]=h*F+L*w+g*_,r[6]=y*F+R*w+T*_,r[7]=d*F+B*w+Y*_,r[8]=m*k+b*C+v*I,r[9]=h*k+L*C+g*I,r[10]=y*k+R*C+T*I,r[11]=d*k+B*C+Y*I,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r}function _t(r,e){let t=e[0],n=e[1],s=e[2];return r[12]+=r[0]*t+r[4]*n+r[7]*s,r[13]+=r[1]*t+r[5]*n+r[8]*s,r[14]+=r[2]*t+r[5]*n+r[9]*s,r[15]+=r[3]*t+r[6]*n+r[10]*s,r}function xt(){let r;return e=>(r||(r=e()),r)}var M=document.querySelector("canvas"),p=M.getContext("webgl"),N=Re(),j=[],rt={animateTurns:!0,hintStickers:!0,showBody:!0};var It=Date.now()*.001,ge=3,Ht=!1;function qt(){Ht||(Ht=!0,requestAnimationFrame(Kt))}function Gt(r){let e=document.querySelector(r),t=new it,n=new lt,s=Se(e),o=new ct;t.setNumOfLayers(ge);let l=at(p,t,s),a={div:e,cube:t,spring:n,buffers:l,perspectiveMatrix:s},i=(d,b)=>{!a.dragEnabled||o.onPointerDown(d,b,a.div,a.cube,a.buffers)},c=(d,b)=>{!a.dragEnabled||o.onPointerMove(d,b)},u=()=>{!a.dragEnabled||o.onPointerUp(a.div,a.cube,a.buffers)},m=d=>{let b=d.target.getBoundingClientRect(),L=d.touches[0].pageX-b.left,R=d.touches[0].pageY-b.top;return{x:L,y:R}},h=()=>{e.addEventListener("pointerdown",d=>i(d.offsetX,d.offsetY)),e.addEventListener("pointermove",d=>c(d.offsetX,d.offsetY)),e.addEventListener("pointerup",d=>u())},y=()=>{e.addEventListener("touchstart",d=>{let{x:b,y:L}=m(d);i(b,L)}),e.addEventListener("touchmove",d=>{let{x:b,y:L}=m(d);c(b,L)}),e.addEventListener("touchend",d=>{u()})};return window.PointerEvent?h():y(),a}function Re(){let t=Le(p,`
    attribute vec4 aVertexPosition;
    attribute vec4 aVertexColor;
    uniform mat4 uTransformMatrix;
    uniform mat4 uRotateMatrix;

    // variables shared between vertex and fragment shaders
    varying lowp vec4 vColor;
    varying lowp vec4 originalPos;
    varying lowp vec4 rotatedPos;
    void main(void) {
        gl_Position = uTransformMatrix * aVertexPosition;
        originalPos = aVertexPosition;
        rotatedPos = uRotateMatrix * aVertexPosition;
        vColor = aVertexColor;
    }
    `,`
    // variables shared between vertex and fragment shaders
    varying lowp vec4 vColor;
    varying lowp vec4 originalPos;
    varying lowp vec4 rotatedPos;

    void main(void) {
        gl_FragColor = vColor;

        // low precision float variable
        lowp float max = 1.05;

        // if it is a normal sticker rather than a hint sticker, it should not be discarded
        if (originalPos.x < max && originalPos.x > -max && originalPos.y < max && originalPos.y > -max && originalPos.z < max && originalPos.z > -max) {
            return;
        }

        // if it starts on the right or left, and stays on its side, it should not be discarded
        if (originalPos.x > max && rotatedPos.x > max) return;
        if (originalPos.x < -max && rotatedPos.x < -max) return;

        if (rotatedPos.y < max && rotatedPos.z < max) return;
        discard;
    }
    `);return p.useProgram(t),{attribLocations:{vertexPosition:p.getAttribLocation(t,"aVertexPosition"),vertexColor:p.getAttribLocation(t,"aVertexColor")},uniformLocations:{transformMatrix:p.getUniformLocation(t,"uTransformMatrix"),rotateMatrix:p.getUniformLocation(t,"uRotateMatrix")}}}function Se(r){let e=tt();return wt(e,50*Math.PI/180,r.clientWidth/r.clientHeight,.1,100),_t(e,[0,0,-5]),et(e,e,45*Math.PI/180,[1,0,0]),et(e,e,0,[0,-1,0]),e}function gt(r,e,t){t.bindBuffer(t.ARRAY_BUFFER,r),t.vertexAttribPointer(e.attribLocations.vertexPosition,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(e.attribLocations.vertexPosition)}function Rt(r,e,t){t.bindBuffer(t.ARRAY_BUFFER,r),t.vertexAttribPointer(e.attribLocations.vertexColor,4,t.FLOAT,!1,0,0),t.enableVertexAttribArray(e.attribLocations.vertexColor)}function St(r){r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0)}function Le(r,e,t){let n=Wt(r,r.VERTEX_SHADER,e),s=Wt(r,r.FRAGMENT_SHADER,t),o=r.createProgram();return r.attachShader(o,n),r.attachShader(o,s),r.linkProgram(o),r.getProgramParameter(o,r.LINK_STATUS)?o:(alert("Unable to initialize the shader program: "+r.getProgramInfoLog(o)),null)}function Wt(r,e,t){let n=r.createShader(e);return r.shaderSource(n,t),r.compileShader(n),r.getShaderParameter(n,r.COMPILE_STATUS)?n:(alert("An error occurred compiling the shaders: "+r.getShaderInfoLog(n)),r.deleteShader(n),null)}function ke(){let r=M.clientWidth,e=M.clientHeight,t=M.width!==r||M.height!==e;return t&&(M.width=r,M.height=e),t}function Kt(r){r*=.001;let e=r-It;It=r,ke(),p.enable(p.DEPTH_TEST),p.enable(p.SCISSOR_TEST),p.depthFunc(p.LEQUAL),p.clear(p.COLOR_BUFFER_BIT|p.DEPTH_BUFFER_BIT),M.style.transform=`translateY(${window.scrollY}px)`;for(let t=0;t<j.length;t++){let{cube:n,div:s,spring:o,buffers:l,perspectiveMatrix:a}=j[t],i=s.getBoundingClientRect();if(i.bottom<0||i.top>M.clientHeight||i.right<0||i.left>M.clientWidth)continue;let c=i.right-i.left,u=i.bottom-i.top,m=i.left,h=M.clientHeight-i.bottom;p.viewport(m,h,c,u),p.scissor(m,h,c,u),n.animationQueue[0]&&(o.target=n.animationQueue.length*90,o.update(e),o.position>=90&&(n.affectedStickers=Array(S(n.layers)).fill(!1),o.position=0,n.animationQueue.shift()));let y=n.animationQueue[0],d=ve(n),b=xt(),L=xt();for(let R=0;R<S(n.layers);R++){let B=l[R],v=y&&y.stickersToAnimate[R]&&rt.animateTurns?b(()=>et(tt(),a,o.position*Math.PI/180,y.axis)):a;p.uniformMatrix4fv(N.uniformLocations.transformMatrix,!1,v);let g=y&&y.stickersToAnimate[R]&&rt.animateTurns?L(()=>{let T=tt();return et(T,T,o.position*Math.PI/180,y.axis)}):tt();p.uniformMatrix4fv(N.uniformLocations.rotateMatrix,!1,g),p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,B.indexBuffer),rt.showBody&&(gt(B.noGapPositionBuffer,N,p),Rt(n.underStickers[R].buffer,N,p),St(p)),gt(B.positionBuffer,N,p),Rt(d[R].buffer,N,p),St(p),rt.hintStickers&&(gt(B.hintPositionBuffer,N,p),Rt(d[R].buffer,N,p),St(p))}}requestAnimationFrame(Kt)}function ve(r){return rt.animateTurns&&r.animationQueue[0]?r.animationQueue[0].stickers:r.stickers}var nt=725,Lt=!1;function kt(r){Lt=!0,r.style.display="flex",r.classList.add("slideLeftOpen"),document.documentElement.clientWidth<nt?r.classList.add("slideLeftClosed"):r.classList.remove("slideLeftClosed")}function ut(r){Lt=!1,document.documentElement.clientWidth<nt?(r.classList.add("slideLeftClosed"),r.classList.remove("slideLeftOpen"),r.style.display="flex"):r.style.display="none"}function vt(r){Lt?ut(r):kt(r)}function zt(){let r=document.querySelector(".slideRight"),e=!1;function t(n){if(e=n,e){r.classList.add("slideRightOpen");return}r.classList.remove("slideRightOpen")}document.addEventListener("click",n=>{let s=n.target;if(s===document.querySelector("#menu")){t(!0);return}e&&!s.closest(".slideRight")&&t(!1)}),document.querySelector("#closeMenu").addEventListener("click",()=>{t(!1)}),document.querySelector("#learnButton").addEventListener("click",()=>{document.location.href="learn.html"}),document.querySelector("#playButton").addEventListener("click",()=>{document.location.href="play.html"}),document.querySelector("#trainButton").addEventListener("click",()=>{document.location.href="train.html"}),document.querySelector("#cubleButton").addEventListener("click",()=>{document.location.href="cuble.html"})}var Ae=document.querySelector("canvas"),Ee=Ae.getContext("webgl");function Nt(r,e){zt(),Me(r,e),Be(r);for(let t=0;t<r.length;t++)jt(r,e,t);st(r),qt(),Ce(),Vt()}function jt(r,e,t){let n=Gt(`#scene${t}`);j.push(n),n.cube.setNumOfLayers(e),n.buffers=at(Ee,j[0].cube,j[0].perspectiveMatrix);let s=r[t];if(s.cube=n.cube,s.move=0,s.practiceProblems)n.dragEnabled=!0,Yt(s);else{let o=Qt(s);n.cube.setColors(o),n.cube.execAlg(s.setup)}}function st(r){for(let e=0;e<r.length;e++){let t=r[e];if(t.practiceProblems&&t.showSolution){let o=t.practiceProblems[t.problemIndex];document.querySelector(`#problemText${e}`).textContent=o.explanation,document.querySelector(`#leftButton${e}`).style.display="",document.querySelector(`#rightButton${e}`).style.display="";let l=document.querySelector(`#moveCounter${e}`);l.style.display="";let a=ht(t.algorithm);l.textContent=`${t.move} / ${a.length}`;continue}if(t.practiceProblems&&!t.showSolution){let o=t.practiceProblems[t.problemIndex];document.querySelector(`#problemText${e}`).textContent=o.directions,document.querySelector(`#leftButton${e}`).style.display="none",document.querySelector(`#rightButton${e}`).style.display="none",document.querySelector(`#moveCounter${e}`).style.display="none";continue}let n=document.querySelector(`#moveCounter${e}`),s=ht(t.algorithm);n.textContent=`${t.move} / ${s.length}`}}function Yt(r){let e=P(r.practiceProblems.length);for(;e===r.problemIndex;)e=P(r.practiceProblems.length);$t(r,e)}function $t(r,e){let t=r.practiceProblems[e];r.problemIndex=e,r.algorithm=r.practiceProblems[e].algorithm;let n=Qt(r);r.cube.setColors(n),r.cube.execAlg(t.setup),r.move=0}function Qt(r){let e=Array(54);r.activeStickers.forEach(t=>{e[t]=Z(J(t,r.cube))});for(let t=0;t<54;t++)e[t]||(e[t]=At);return e}function Me(r,e){let t=document.querySelector("#lessonNavigator");t.addEventListener("click",n=>{let s=n.target;if(s.className==="lesson-p"){let o=parseInt(s.getAttribute("lesson-index"));jt(r,e,o),document.documentElement.clientWidth<nt&&ut(t)}}),document.querySelector("#openClose").addEventListener("click",n=>{vt(t)}),document.querySelector("#close").addEventListener("click",n=>{vt(t)})}function Be(r){let e="leftButton",t="rightButton",n="showSolution",s="next";document.addEventListener("click",o=>{let l=o.target;if(l.id.startsWith(e)){let a=parseInt(l.id.substring(e.length)),i=r[a];if(i.move<=0)return;i.move--;let c=ht(i.algorithm);i.cube.stepAlgorithm(c[i.move],!1),st(r)}else if(l.id.startsWith(t)){let a=parseInt(l.id.substring(t.length)),i=r[a],c=ht(i.algorithm);if(i.move>=c.length)return;i.cube.stepAlgorithm(c[i.move],!0),i.move++,st(r)}else if(l.id.startsWith(n)){let a=parseInt(l.id.substring(n.length)),i=r[a];i.showSolution=!0,j[a].dragEnabled=!1,$t(i,i.problemIndex),st(r)}else if(l.id.startsWith(s)){let a=parseInt(l.id.substring(s.length)),i=r[a];i.showSolution=!1,j[a].dragEnabled=!0,Yt(i),st(r)}})}function Ce(){window.addEventListener("resize",()=>{Vt()})}function Vt(){let r=document.querySelector("#openClose"),e=document.querySelector("#close"),t=document.querySelector("#lessonNavigator");if(document.documentElement.clientWidth<nt){r.style.display="inline-block",e.style.display="inline-block",ut(t);return}r.style.display="none",e.style.display="none",kt(t)}function ht(r){return(r||"").split(" ")}var Pe=[4,13,22,31,40,49],Oe=[0,29,36],Ue=[6,35,51],De=[2,9,42],Fe=[8,15,45],we=[18,11,44],_e=[24,47,17],Ie=[20,38,27],He=[26,33,53],We=[3,32],qe=[1,39],Ge=[7,48],Ke=[5,12],ze=[10,43],Ne=[16,46],je=[21,14],Ye=[19,41],$e=[25,50],Qe=[23,30],Ve=[28,37],Xe=[34,52],Ze=[...Oe,...Ue,...De,...Fe],Je=[...we,..._e,...Ie,...He],tr=[...We,...qe,...Ge,...Ke],er=[...ze,...Ne,...Ve,...Xe],rr=[...je,...Ye,...$e,...Qe],nr=[...Pe,...tr],sr=[...nr,...Ze],E=[...sr,...er];var ir=[...rr,...Je],$r=[...E,...ir];var or=[{activeStickers:E,setup:"z2 R U R'",algorithm:"R U' R'"},{activeStickers:E,setup:"z2 L' U' L",algorithm:"L' U L"},{activeStickers:E,setup:"z2 R U' R'",algorithm:"R U R'"},{activeStickers:E,setup:"z2 R U R' U2 R U' R'",algorithm:"R U R' U U R U' R'"},{activeStickers:E,setup:"z2 R U R' U2 R U' R' d'",algorithm:"R U R'"},{activeStickers:E,setup:"z2 R U R' U2 R U R'",algorithm:"R U' R' U U R U' R'"},{activeStickers:E,setup:"z2 F' U F U' R U' R'",algorithm:"R U R' U F' U' F"},{activeStickers:E,setup:"z2 F' U F U R U' R'",algorithm:"R U R' U' F' U' F"},{activeStickers:E,setup:"z2 R U' R' U R U' R'",algorithm:"R U R' U' R U R'"},{activeStickers:E,setup:"z2 R U' R' U2 R U R'",algorithm:"R U' R' U U R U R'"}];function ar(){Nt(or,3)}ar();})();
//# sourceMappingURL=learnF2L.js.map
