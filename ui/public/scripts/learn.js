(()=>{var Ze=[1,1,1,1],et=[.5,.5,.5,1],tt=[1,1,0,1],rt=[.5,.5,0,1],st=[0,1,0,1],nt=[0,.5,0,1],it=[0,0,1,1],ot=[0,0,.5,1],at=[1,.5,0,1],lt=[.5,.25,0,1],ct=[1,0,0,1],ut=[.5,0,0,1],Ae=[0,0,0,1],ce=[Ze,st,tt,it,at,ct];function J(r){return(r<0||r>=ce.length)&&console.error("Invalid face: "+r),ce[r]}var ft=[et,nt,rt,ot,lt,ut];function Ee(r){return(r<0||r>=ce.length)&&console.error("Invalid face: "+r),ft[r]}function Oe(r,t,e){let s=ue(t,1.01,.02),n=ue(t,1,0),i=ue(t,1.5,.02),l=Array(t.numOfStickers);for(let o=0;o<t.numOfStickers;o++){let a={positionBuffer:r.createBuffer(),noGapPositionBuffer:r.createBuffer(),hintPositionBuffer:r.createBuffer(),indexBuffer:r.createBuffer(),cart2d:[],positions:null},c=new Float32Array(12),f=new Float32Array(12),h=new Float32Array(12);for(let u=0;u<12;u++){let R=o*12+u;c[u]=s[R],f[u]=n[R],h[u]=i[R]}if(r.bindBuffer(r.ARRAY_BUFFER,a.positionBuffer),r.bufferData(r.ARRAY_BUFFER,c,r.STATIC_DRAW),a.positions=c,r.bindBuffer(r.ARRAY_BUFFER,a.noGapPositionBuffer),r.bufferData(r.ARRAY_BUFFER,f,r.STATIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,a.hintPositionBuffer),r.bufferData(r.ARRAY_BUFFER,h,r.STATIC_DRAW),e){let u=Array(16);te(u,0,e,[f[0],f[1],f[2],1]),te(u,4,e,[f[3],f[4],f[5],1]),te(u,8,e,[f[6],f[7],f[8],1]),te(u,12,e,[f[9],f[10],f[11],1]),a.cart2d=[u[0]/u[3],u[1]/u[3],u[4]/u[7],u[5]/u[7],u[8]/u[11],u[9]/u[11],u[12]/u[15],u[13]/u[15]]}let m=[0,1,2,0,2,3];r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,a.indexBuffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,new Uint16Array(m),r.STATIC_DRAW),l[o]=a}return l}function te(r,t,e,s){let n=Array(4),i=s[0],l=s[1],o=s[2],a=s[3];r[t+0]=i*e[0]+l*e[4]+o*e[8]+a*e[12],r[t+1]=i*e[1]+l*e[5]+o*e[9]+a*e[13],r[t+2]=i*e[2]+l*e[6]+o*e[10]+a*e[14],r[t+3]=i*e[3]+l*e[7]+o*e[11]+a*e[15]}var Me=12,ht=4,G=3;function ue(r,t,e){let s=r.layersSq*Me,n=Array(6*s);return mt(n,0*s,r,1,t,e),yt(n,1*s,r,0,t,e),Rt(n,2*s,r,1,-t,e),dt(n,3*s,r,0,-t,e),pt(n,4*s,r,2,-t,e),Ut(n,5*s,r,2,t,e),n}function mt(r,t,e,s,n,i){if(e.layersEven){let a=Array(e.layersSq),c=0;for(let f=0;f<e.layers;f++)for(let h=0;h<e.layers;h++){let m=-1+1/e.layers+h*2/e.layers,u=-1+1/e.layers+f*2/e.layers;a[c]=[m,u,n],c++}S(r,t,e,a,s,i);return}let l=Array(e.layersSq),o=0;for(let a=-e.layersHalf;a<=e.layersHalf;a++)for(let c=-e.layersHalf;c<=e.layersHalf;c++)l[o]=[2*c/e.layers,2*a/e.layers,n],o++;S(r,t,e,l,s,i)}function yt(r,t,e,s,n,i){if(e.layersEven){let a=Array(e.layersSq),c=0;for(let f=0;f<e.layers;f++)for(let h=e.layers-1;h>=0;h--){let m=-1+1/e.layers+f*2/e.layers,u=-1+1/e.layers+h*2/e.layers;a[c]=[m,u,n],c++}S(r,t,e,a,s,i);return}let l=Array(e.layersSq),o=0;for(let a=-e.layersHalf;a<=e.layersHalf;a++)for(let c=e.layersHalf;c>=-e.layersHalf;c--)l[o]=[2*a/e.layers,2*c/e.layers,n],o++;S(r,t,e,l,s,i)}function Rt(r,t,e,s,n,i){if(e.layersEven){let a=Array(e.layersSq),c=0;for(let f=0;f<e.layers;f++)for(let h=e.layers-1;h>=0;h--){let m=-1+1/e.layers+h*2/e.layers,u=-1+1/e.layers+f*2/e.layers;a[c]=[m,u,n],c++}S(r,t,e,a,s,i);return}let l=Array(e.layersSq),o=0;for(let a=-e.layersHalf;a<=e.layersHalf;a++)for(let c=e.layersHalf;c>=-e.layersHalf;c--)l[o]=[2*c/e.layers,2*a/e.layers,n],o++;S(r,t,e,l,s,i)}function dt(r,t,e,s,n,i){if(e.layersEven){let a=Array(e.layersSq),c=0;for(let f=0;f<e.layers;f++)for(let h=0;h<e.layers;h++){let m=-1+1/e.layers+f*2/e.layers,u=-1+1/e.layers+h*2/e.layers;a[c]=[m,u,n],c++}S(r,t,e,a,s,i);return}let l=Array(e.layersSq),o=0;for(let a=-e.layersHalf;a<=e.layersHalf;a++)for(let c=-e.layersHalf;c<=e.layersHalf;c++)l[o]=[2*a/e.layers,2*c/e.layers,n],o++;S(r,t,e,l,s,i)}function pt(r,t,e,s,n,i){if(e.layersEven){let a=Array(e.layersSq),c=0;for(let f=0;f<e.layers;f++)for(let h=e.layers-1;h>=0;h--){let m=-1+1/e.layers+h*2/e.layers,u=-1+1/e.layers+f*2/e.layers;a[c]=[m,u,n],c++}S(r,t,e,a,s,i);return}let l=Array(e.layersSq),o=0;for(let a=-e.layersHalf;a<=e.layersHalf;a++)for(let c=e.layersHalf;c>=-e.layersHalf;c--)l[o]=[2*c/e.layers,2*a/e.layers,n],o++;S(r,t,e,l,s,i)}function Ut(r,t,e,s,n,i){if(e.layersEven){let a=Array(e.layersSq),c=0;for(let f=e.layers-1;f>=0;f--)for(let h=e.layers-1;h>=0;h--){let m=-1+1/e.layers+h*2/e.layers,u=-1+1/e.layers+f*2/e.layers;a[c]=[m,u,n],c++}S(r,t,e,a,s,i);return}let l=Array(e.layersSq),o=0;for(let a=e.layersHalf;a>=-e.layersHalf;a--)for(let c=e.layersHalf;c>=-e.layersHalf;c--)l[o]=[2*c/e.layers,2*a/e.layers,n],o++;S(r,t,e,l,s,i)}function S(r,t,e,s,n,i){for(let l=0;l<e.layersSq;l++){let o=s[l];Lt(r,t+l*Me,e,o[0],o[1],o[2],n,i)}}function Lt(r,t,e,s,n,i,l,o){let a=1/e.layers-o,c=[[s-a,n-a,i],[s+a,n-a,i],[s+a,n+a,i],[s-a,n+a,i]];for(let f=0;f<ht;f++){let h=c[f];r[t+f*G]=h[(l+0)%G],r[t+f*G+1]=h[(l+1)%G],r[t+f*G+2]=h[(l+2)%G]}}var re=class{constructor(){this.position=0,this._velocity=200,this._acceleration=0,this.target=0}update(t){let e=-100*(this.position-this.target),s=-15*this._velocity;this._acceleration=e+s,this._velocity+=this._acceleration*t,this.position+=this._velocity*t}};function Y(r,t){return Math.floor(r/t.layersSq)}function Q(r){return Math.floor(Math.random()*r)}function Ce(r){let t=r.length;for(;t!=0;){let e=Q(t);t--;let s=r[e];r[e]=r[t],r[t]=s}return r}var I=0,_=1,P=2,q=3,H=4,w=5,St=[[I,q,H],[I,w,q],[I,H,_],[I,_,w],[P,_,H],[P,w,_],[P,H,q],[P,q,w]],gt=[[I,q],[I,H],[I,w],[I,_],[_,H],[_,w],[P,_],[P,H],[P,w],[P,q],[q,H],[q,w]];function Pe(r){let t=Ie(12,2),e=Ie(8,3),s=fe(8),n=fe(12);for(;_e(s)!==_e(n);)s=fe(8);let i=Array(54);for(let d=0;d<6;d++){let k=r.center(d);i[k]=d}let l=r.corners(0,0),o=r.corners(1,0),a=r.corners(2,0),c=r.corners(3,0),f=r.corners(4,0),h=r.corners(5,0),m=(d,k,N,B,A,E,T,O,M)=>{let L=(D,C)=>St[s[D]][(e[D]+C)%3];i[d.topLeft]=L(k,E),i[d.topRight]=L(N,T),i[d.bottomLeft]=L(B,O),i[d.bottomRight]=L(A,M)};m(l,0,1,2,3,0,0,0,0),m(o,2,3,4,5,2,1,1,2),m(a,4,5,6,7,0,0,0,0),m(c,6,7,0,1,2,1,1,2),m(f,0,2,6,4,2,1,1,2),m(h,3,1,5,7,2,1,1,2);let u=r.edges(0,0,0),R=r.edges(1,0,0),p=r.edges(2,0,0),U=r.edges(3,0,0),g=r.edges(4,0,0),K=r.edges(5,0,0),b=(d,k,N,B,A,E,T,O,M)=>{let L=(D,C)=>gt[n[D]][(t[D]+C)%2];i[d.top]=L(k,E),i[d.left]=L(N,T),i[d.right]=L(B,O),i[d.bottom]=L(A,M)};return b(u,0,1,2,3,0,0,0,0),b(R,3,4,5,6,1,0,0,1),b(p,6,7,8,9,0,0,0,0),b(U,9,10,11,0,1,0,0,1),b(g,1,10,4,7,1,1,1,1),b(K,2,5,11,8,1,1,1,1),i}function Ie(r,t){let e=Array(r);for(let s=0;s<r;s++)e[s]=Q(t);for(;!xt(e,t);){let s=Q(r);e[s]=Q(t)}return e}function xt(r,t){let e=0;for(let s=0;s<r.length;s++)e+=r[s];return e%t===0}function fe(r){let t=Array(r);for(let e=0;e<r;e++)t[e]=e;return Ce(t),t}function _e(r){let t=[...r],e=!1;for(;;)if(t[0]===0){let s=t.findIndex((n,i)=>n!==i);if(s===-1)return e;t[0]=t[s],t[s]=0,e=!e}else{let s=t[0];t[0]=t[s],t[s]=s,e=!e}}var Ft=document.querySelector("canvas"),j=Ft.getContext("webgl");function he(r,t){let e=[t[0],t[1],t[2],t[3],t[0],t[1],t[2],t[3],t[0],t[1],t[2],t[3],t[0],t[1],t[2],t[3]];j.bindBuffer(j.ARRAY_BUFFER,r.buffer),j.bufferData(j.ARRAY_BUFFER,new Float32Array(e),j.STATIC_DRAW)}var se=class{constructor(){this.animationQueue=[]}new(){this.axis=0,this.stickers=Array(this.numOfStickers),this.underStickers=Array(this.numOfStickers);for(let t=0;t<this.numOfStickers;t++){let e=Y(t,this);this.stickers[t]={face:e,buffer:j.createBuffer()},this.underStickers[t]={face:e,buffer:j.createBuffer()},he(this.underStickers[t],Ae)}this.affectedStickers=Array(this.numOfStickers).fill(!1)}isSolved(){let t;for(let e=0;e<this.numOfStickers;e++){if(e%this.layersSq===0){t=this.stickers[e].face;continue}if(t!==this.stickers[e].face)return!1}return!0}setColors(t){for(let e=0;e<this.numOfStickers;e++)this.setColor(t[e],e)}setColor(t,e){he(this.stickers[e],t)}solve(){let t=Array(this.numOfStickers);for(let e=0;e<this.numOfStickers;e++)t[e]=J(Y(e,this));this.setColors(t)}scramble(){if(this.layers===3){this.scramble3x3();return}this.naiveScramble()}scramble3x3(){let t=Pe(this);this.setCubeState(t)}naiveScramble(){let t=this.layersSq*10;for(let e=0;e<t;e++){let s=Math.floor(Math.random()*3),n=Math.floor(Math.random()*this.layers),i=Math.floor(Math.random()*1)==0;this._matchTurn(s,n,i)}}setNumOfLayers(t){this.layers=t,this.layersSq=t*t,this.layersHalf=Math.floor(this.layers/2),this.layersEven=this.layers%2==0,this.numOfStickers=this.layersSq*6}getCubeState(){return this.stickers.map(t=>t.face)}setCubeState(t){for(let e=0;e<this.numOfStickers;e++){let s=J(t[e]);this.stickers[e].face=t[e],he(this.stickers[e],s)}}resetAffectedStickers(){this.affectedStickers=Array(this.numOfStickers).fill(this.layers===1)}pushAnimation(t,e,s){let n=e?-1:1,i=[0,0,0];i[t]=n,this.animationQueue.push({axis:i,stickers:s,stickersToAnimate:this.affectedStickers})}turn(t,e,s){this.resetAffectedStickers(),this.pushAnimation(t,s,[...this.stickers]),this._matchTurn(t,e,s)}sliceTurn(t,e){this.affectedStickers=Array(this.numOfStickers).fill(!1),this.pushAnimation(t,e,[...this.stickers]);for(let s=1;s<this.layers-1;s++)this._matchTurn(t,s,e)}wideTurn(t,e,s){this.resetAffectedStickers(),this.pushAnimation(t,s,[...this.stickers]),this._matchTurn(t,e,s);for(let n=1;n<this.layers-1;n++)this._matchTurn(t,n,s)}cubeRotate(t,e){this.resetAffectedStickers(),this.pushAnimation(t,e,[...this.stickers]);for(let s=0;s<this.layers;s++)this._matchTurn(t,s,e)}_matchTurn(t,e,s){t==0?(this._turnXAxis(e,s),e==0?this._turnOuter(5,s):e==this.layers-1&&this._turnOuter(4,!s)):t==1?(this._turnYAxis(e,s),e==0?this._turnOuter(0,s):e==this.layers-1&&this._turnOuter(2,!s)):t==2?(this._turnZAxis(e,s),e==0?this._turnOuter(1,s):e==this.layers-1&&this._turnOuter(3,!s)):console.error(`Axis ${t} not recognized`)}_turnXAxis(t,e){for(let s=1;s<=this.layers;s++)this._cycle(e,0*this.layersSq+this.layersSq-s-t*this.layers,3*this.layersSq+this.layersSq-s-t*this.layers,2*this.layersSq+this.layersSq-s-t*this.layers,1*this.layersSq+this.layersSq-s-t*this.layers)}_turnYAxis(t,e){for(let s=0;s<this.layers;s++)this._cycle(e,1*this.layersSq+s*this.layers+t,4*this.layersSq+s*this.layers+t,3*this.layersSq+(this.layers-s-1)*this.layers+(this.layers-1)-t,5*this.layersSq+s*this.layers+t)}_turnZAxis(t,e){for(let s=0;s<this.layers;s++)this._cycle(e,0*this.layersSq+(s+1)*this.layers-1-t,5*this.layersSq+s+this.layers*t,2*this.layersSq+(this.layers-s-1)*this.layers+t,4*this.layersSq+this.layersSq-(s+1)-t*this.layers)}_turnOuter(t,e){if(this.layers%2!=0){let s=this.center(t);this.affectedStickers[s]=!0}for(let s=0;s<Math.floor(this.layers/2);s++){let{topLeft:n,topRight:i,bottomLeft:l,bottomRight:o}=this.corners(t,s);this._cycle(e,n,i,o,l);let a=this.layers-2*(s+1);for(let c=0;c<a;c++){let{top:f,left:h,bottom:m,right:u}=this.edges(t,s,c);this._cycle(e,f,u,m,h)}}}_cycle(t,e,s,n,i){this.affectedStickers[e]=!0,this.affectedStickers[s]=!0,this.affectedStickers[n]=!0,this.affectedStickers[i]=!0,t?this._cycleHelper(e,s,n,i):this._cycleHelper(i,n,s,e)}_cycleHelper(t,e,s,n){let i=this.stickers[n];this.stickers[n]=this.stickers[s],this.stickers[s]=this.stickers[e],this.stickers[e]=this.stickers[t],this.stickers[t]=i}matchKeyToTurn(t){if(this.disableTurn||t.ctrlKey)return;switch(t.code){case"KeyN":return this.cubeRotate(0,!0),{notation:"x",rotate:!0};case"KeyB":return this.cubeRotate(0,!1),{notation:"x'",rotate:!0};case"Semicolon":return this.cubeRotate(1,!0),{notation:"y",rotate:!0};case"KeyA":return this.cubeRotate(1,!1),{notation:"y'",rotate:!0};case"KeyP":return this.cubeRotate(2,!0),{notation:"z",rotate:!0};case"KeyQ":return this.cubeRotate(2,!1),{notation:"z'",rotate:!0};case"KeyJ":return this.turn(1,0,!0),{notation:"U",turn:!0};case"KeyF":return this.turn(1,0,!1),{notation:"U'",turn:!0};case"KeyS":return this.turn(1,this.layers-1,!1),{notation:"D",turn:!0};case"KeyL":return this.turn(1,this.layers-1,!0),{notation:"D'",turn:!0};case"KeyH":return this.turn(2,0,!0),{notation:"F",turn:!0};case"KeyG":return this.turn(2,0,!1),{notation:"F'",turn:!0};case"KeyW":return this.turn(2,this.layers-1,!1),{notation:"B",turn:!0};case"KeyO":return this.turn(2,this.layers-1,!0),{notation:"B'",turn:!0};case"KeyD":return this.turn(0,this.layers-1,!1),{notation:"L",turn:!0};case"KeyE":return this.turn(0,this.layers-1,!0),{notation:"L'",turn:!0};case"KeyI":return this.turn(0,0,!0),{notation:"R",turn:!0};case"KeyK":return this.turn(0,0,!1),{notation:"R'",turn:!0};case"BracketLeft":return this.sliceTurn(0,!1),{notation:"M",turn:!0};case"Quote":return this.sliceTurn(0,!0),{notation:"M'",turn:!0};case"KeyC":return this.sliceTurn(1,!1),{notation:"E",turn:!0};case"Comma":return this.sliceTurn(1,!0),{notation:"E'",turn:!0};case"KeyY":return this.sliceTurn(2,!0),{notation:"S",turn:!0};case"KeyT":return this.sliceTurn(2,!1),{notation:"S'",turn:!0};case"KeyU":return this.wideTurn(0,0,!0),{notation:"r",turn:!0};case"KeyM":return this.wideTurn(0,0,!1),{notation:"r'",turn:!0};case"KeyV":return this.wideTurn(0,this.layers-1,!1),{notation:"l",turn:!0};case"KeyR":return this.wideTurn(0,this.layers-1,!0),{notation:"l'",turn:!0}}}stepAlgorithm(t,e){switch(t){case"x":this.cubeRotate(0,e);break;case"x'":this.cubeRotate(0,!e);break;case"x2":this.cubeRotate(0,e),this.cubeRotate(0,e);break;case"y":this.cubeRotate(1,e);break;case"y'":this.cubeRotate(1,!e);break;case"y2":this.cubeRotate(1,e),this.cubeRotate(1,e);break;case"z":this.cubeRotate(2,e);break;case"z'":this.cubeRotate(2,!e);break;case"z2":this.cubeRotate(2,e),this.cubeRotate(2,e);break;case"U":this.turn(1,0,e);break;case"U'":this.turn(1,0,!e);break;case"U2":case"U2'":this.turn(1,0,e),this.turn(1,0,e);break;case"D":this.turn(1,this.layers-1,!e);break;case"D'":this.turn(1,this.layers-1,e);break;case"D2":this.turn(1,this.layers-1,e),this.turn(1,this.layers-1,e);break;case"F":this.turn(2,0,e);break;case"F'":this.turn(2,0,!e);break;case"F2":this.turn(2,0,e),this.turn(2,0,e);break;case"B":this.turn(2,this.layers-1,!e);break;case"B'":this.turn(2,this.layers-1,e);break;case"B2":this.turn(2,this.layers-1,e),this.turn(2,this.layers-1,e);break;case"L":this.turn(0,this.layers-1,!e);break;case"L'":this.turn(0,this.layers-1,e);break;case"L2":this.turn(0,this.layers-1,e),this.turn(0,this.layers-1,e);break;case"l":this.wideTurn(0,this.layers-1,!e);break;case"l'":this.wideTurn(0,this.layers-1,e);break;case"R":this.turn(0,0,e);break;case"R'":this.turn(0,0,!e);break;case"R2":case"R2'":this.turn(0,0,e),this.turn(0,0,e);break;case"r":this.wideTurn(0,0,e);break;case"r'":this.wideTurn(0,0,!e);break;case"r2":case"r2'":this.wideTurn(0,0,e),this.wideTurn(0,0,e);break;case"M":this.turn(0,1,!e);break;case"M'":this.turn(0,1,e);break;case"M2":this.sliceTurn(0,e),this.sliceTurn(0,e);break;case"E":this.sliceTurn(1,!e);break;case"E'":this.sliceTurn(1,e);break;case"S":this.sliceTurn(2,e);break;case"S'":this.sliceTurn(2,!e);break;default:throw new Error("Invalid turn in algorithm: "+t)}}execAlg(t){if(!t)return;let e=t.split(" ");for(let s=0;s<e.length;s++)this.stepAlgorithm(e[s],!0);this.animationQueue=[]}execAlgReverse(t){if(!t)return;let e=t.split(" ");for(let s=e.length-1;s>=0;s--)this.stepAlgorithm(e[s],!1);this.animationQueue=[]}stickerIsOnFace(t,e){return e*this.layersSq<=t&&t<(e+1)*this.layersSq}center(t){return t*this.layersSq+Math.floor(this.layersSq/2)}corners(t,e){let s=t*this.layersSq;return{topLeft:s+(this.layers+1)*e,topRight:s+(this.layers-1)*(this.layers-e),bottomRight:s+(this.layers+1)*(this.layers-e-1),bottomLeft:s+(this.layers-1)*(e+1)}}edges(t,e,s){let n=this.corners(t,e),i=this.layers-2*(e+1);return{top:n.topLeft+this.layers*(s+1),left:n.topLeft+(i-s),right:n.topRight+s+1,bottom:n.bottomLeft+this.layers*(i-s)}}};function qe(r,t){return r/t*2-1}function He(r,t){return 1-r/t*2}function me(r,t,e,s){return r<e?(s-t)/(e-r):(t-s)/(r-e)}function V(r,t,e,s,n,i){return Math.abs(.5*(r*(s-i)+e*(i-t)+n*(t-s)))}function bt(r,t){return r.layers-1-t%r.layers}function ye(r,t){return r.layers-1-Math.floor(t/r.layers)}function Dt(r,t){return t%r.layers}function Re(r,t){return r.layers-1-Math.floor((t-r.layersSq)/r.layers)}var ne=class{onPointerDown(t,e,s,n,i){this.numOfPointerMoves=0;let l=qe(t,s.clientWidth),o=He(e,s.clientHeight);this.xOnDown=l,this.yOnDown=o,[this.stickerOnDown,this.cart2dOnDown]=this._coordinatesToSticker(l,o,n,i);function a(p,U,g){return{x:i[p].cart2d[U],y:i[p].cart2d[g]}}if(this.stickerOnDown!==-1)return;let c=a(0,0,1),f=a(n.layers*(n.layers-1),6,7),h=a(n.layers-1,2,3),m=a(n.layersSq-1,4,5),u=a(n.layers*(n.layers+1)-1,0,1),R=a(n.layersSq*2-1,2,3);o>c.y&&l>c.x&&l<f.x?n.cubeRotate(0,!0):l<c.x&&o>h.y&&o<c.y?n.cubeRotate(2,!1):l>f.x&&o>m.y&&o<f.y?n.cubeRotate(2,!0):l<u.x&&o>u.y&&o<h.y?n.cubeRotate(1,!0):l>R.x&&o>R.y&&o<m.y?n.cubeRotate(1,!1):o<u.y&&l>u.x&&l<R.x&&n.cubeRotate(0,!1)}onPointerMove(t,e){this.numOfPointerMoves++,this.xOnMove=t,this.yOnMove=e}onPointerUp(t,e,s){if(this.numOfPointerMoves<2)return;let n,i;if(this.stickerOnDown!==-1&&(n=me(this.cart2dOnDown[0],this.cart2dOnDown[1],this.cart2dOnDown[4],this.cart2dOnDown[5]),i=me(this.cart2dOnDown[2],this.cart2dOnDown[3],this.cart2dOnDown[6],this.cart2dOnDown[7]),n<0)){let h=n;n=i,i=h}let l=qe(this.xOnMove,t.clientWidth),o=He(this.yOnMove,t.clientHeight),a=me(l,o,this.xOnDown,this.yOnDown),[c,f]=this._coordinatesToSticker(l,o,e,s);e.stickerIsOnFace(this.stickerOnDown,0)?l===this.xOnDown?e.turn(0,ye(e,this.stickerOnDown),o>this.yOnDown):a>n?e.turn(0,ye(e,this.stickerOnDown),l>this.xOnDown):a<i?e.turn(0,ye(e,this.stickerOnDown),l<this.xOnDown):e.turn(2,bt(e,this.stickerOnDown),l>this.xOnDown):e.stickerIsOnFace(this.stickerOnDown,1)&&(l===this.xOnDown?e.turn(0,Re(e,this.stickerOnDown),o>this.yOnDown):a>n?e.turn(0,Re(e,this.stickerOnDown),l>this.xOnDown):a<i?e.turn(0,Re(e,this.stickerOnDown),l<this.xOnDown):e.turn(1,Dt(e,this.stickerOnDown),l<this.xOnDown))}_coordinatesToSticker(t,e,s,n){let i=l=>{if(!n[l].cart2d)return;let o=n[l].cart2d,a=V(o[0],o[1],o[2],o[3],o[4],o[5])+V(o[0],o[1],o[4],o[5],o[6],o[7]),c=V(t,e,o[0],o[1],o[2],o[3])+V(t,e,o[2],o[3],o[4],o[5])+V(t,e,o[4],o[5],o[6],o[7])+V(t,e,o[6],o[7],o[0],o[1]),f=1e-5;if(Math.abs(a-c)<f)return[l,o]};for(let l=0;l<2*s.layersSq;l++){let o=i(l);if(o)return o}for(let l=4*s.layersSq;l<5*s.layersSq;l++){let o=i(l);if(o)return o}return[-1,void 0]}};function de(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function we(r,t,e,s,n){let i=1/Math.tan(t/2);if(r[0]=i/e,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=i,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,n!=null&&n!==1/0){let l=1/(s-n);r[10]=(n+s)*l,r[14]=2*n*s*l}else r[10]=-1,r[14]=-2*s;return r}function ie(r,t,e,s){let n=s[0],i=s[1],l=s[2],o=1/Math.hypot(n,i,l);n*=o,i*=o,l*=o;let a=Math.sin(e),c=Math.cos(e),f=1-c,h=t[0],m=t[1],u=t[2],R=t[3],p=t[4],U=t[5],g=t[6],K=t[7],b=t[8],d=t[9],k=t[10],N=t[11],B=n*n*f+c,A=i*n*f+l*a,E=l*n*f-i*a,T=n*i*f-l*a,O=i*i*f+c,M=l*i*f+n*a,L=n*l*f+i*a,D=i*l*f-n*a,C=l*l*f+c;return r[0]=h*B+p*A+b*E,r[1]=m*B+U*A+d*E,r[2]=u*B+g*A+k*E,r[3]=R*B+K*A+N*E,r[4]=h*T+p*O+b*M,r[5]=m*T+U*O+d*M,r[6]=u*T+g*O+k*M,r[7]=R*T+K*O+N*M,r[8]=h*L+p*D+b*C,r[9]=m*L+U*D+d*C,r[10]=u*L+g*D+k*C,r[11]=R*L+K*D+N*C,t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r}function ze(r,t){let e=t[0],s=t[1],n=t[2];return r[12]+=r[0]*e+r[4]*s+r[7]*n,r[13]+=r[1]*e+r[5]*s+r[8]*n,r[14]+=r[2]*e+r[5]*s+r[9]*n,r[15]+=r[3]*e+r[6]*s+r[10]*n,r}function We(){let r;return t=>(r||(r=t()),r)}var x=document.querySelector("canvas"),y=x.getContext("webgl"),z=At(),oe=[],v={animateTurns:!0,dragEnabled:!0,hintStickers:!0,showBody:!0};var Ke=Date.now()*.001,Bt=3,Ne=!1;function Ge(){Ne||(Ne=!0,requestAnimationFrame(Qe))}function Ye(r){let t=document.querySelector(r),e=new se,s=new re,n=Et(t),i=new ne;e.setNumOfLayers(Bt),e.new();let l=Oe(y,e,n),o=(u,R)=>{!v.dragEnabled||i.onPointerDown(u,R,t,e,l)},a=(u,R)=>{!v.dragEnabled||i.onPointerMove(u,R)},c=()=>{!v.dragEnabled||i.onPointerUp(t,e,l)},f=u=>{let R=u.target.getBoundingClientRect(),p=u.touches[0].pageX-R.left,U=u.touches[0].pageY-R.top;return{x:p,y:U}},h=()=>{t.addEventListener("pointerdown",u=>o(u.offsetX,u.offsetY)),t.addEventListener("pointermove",u=>a(u.offsetX,u.offsetY)),t.addEventListener("pointerup",u=>c())},m=()=>{t.addEventListener("touchstart",u=>{let{x:R,y:p}=f(u);o(R,p)}),t.addEventListener("touchmove",u=>{let{x:R,y:p}=f(u);a(R,p)}),t.addEventListener("touchend",u=>{c()})};return window.PointerEvent?h():m(),{div:t,cube:e,spring:s,buffers:l,transformMatrix:n}}function At(){let e=Tt(y,`
    attribute vec4 aVertexPosition;
    attribute vec4 aVertexColor;
    uniform mat4 uTransformMatrix;
    varying lowp vec4 vColor;
    void main(void) {
        gl_Position = uTransformMatrix * aVertexPosition;
        vColor = aVertexColor;
    }
    `,`
    varying lowp vec4 vColor;
    void main(void) {
        gl_FragColor = vColor;
    }
    `);return y.useProgram(e),{attribLocations:{vertexPosition:y.getAttribLocation(e,"aVertexPosition"),vertexColor:y.getAttribLocation(e,"aVertexColor")},uniformLocations:{transformMatrix:y.getUniformLocation(e,"uTransformMatrix")}}}function Et(r){let t=de();return we(t,50*Math.PI/180,r.clientWidth/r.clientHeight,.1,100),ze(t,[0,0,-5]),ie(t,t,45*Math.PI/180,[1,0,0]),ie(t,t,0,[0,-1,0]),t}function pe(r,t,e){e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribPointer(t.attribLocations.vertexPosition,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(t.attribLocations.vertexPosition)}function Ue(r,t,e){e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribPointer(t.attribLocations.vertexColor,4,e.FLOAT,!1,0,0),e.enableVertexAttribArray(t.attribLocations.vertexColor)}function Le(r){r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0)}function Tt(r,t,e){let s=je(r,r.VERTEX_SHADER,t),n=je(r,r.FRAGMENT_SHADER,e),i=r.createProgram();return r.attachShader(i,s),r.attachShader(i,n),r.linkProgram(i),r.getProgramParameter(i,r.LINK_STATUS)?i:(alert("Unable to initialize the shader program: "+r.getProgramInfoLog(i)),null)}function je(r,t,e){let s=r.createShader(t);return r.shaderSource(s,e),r.compileShader(s),r.getShaderParameter(s,r.COMPILE_STATUS)?s:(alert("An error occurred compiling the shaders: "+r.getShaderInfoLog(s)),r.deleteShader(s),null)}function Ot(){let r=x.clientWidth,t=x.clientHeight,e=x.width!==r||x.height!==t;return e&&(x.width=r,x.height=t),e}function Qe(r){r*=.001;let t=r-Ke;Ke=r,Ot(),y.enable(y.DEPTH_TEST),y.enable(y.SCISSOR_TEST),y.depthFunc(y.LEQUAL),y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT),x.style.transform=`translateY(${window.scrollY}px)`;for(let e=0;e<oe.length;e++){let{cube:s,div:n,spring:i,buffers:l,transformMatrix:o}=oe[e],a=n.getBoundingClientRect();if(a.bottom<0||a.top>x.clientHeight||a.right<0||a.left>x.clientWidth)continue;let c=a.right-a.left,f=a.bottom-a.top,h=a.left,m=x.clientHeight-a.bottom;y.viewport(h,m,c,f),y.scissor(h,m,c,f),s.animationQueue[0]&&(i.target=s.animationQueue.length*90,i.update(t),i.position>=90&&(s.affectedStickers=Array(s.numOfStickers).fill(!1),i.position=0,s.animationQueue.shift()));let u=s.animationQueue[0],R=Mt(s),p=We();for(let U=0;U<s.numOfStickers;U++){let g=l[U],K=u&&u.stickersToAnimate[U]&&v.animateTurns?p(()=>ie(de(),o,i.position*Math.PI/180,u.axis)):o;y.uniformMatrix4fv(z.uniformLocations.transformMatrix,!1,K),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,g.indexBuffer),v.showBody&&(pe(g.noGapPositionBuffer,z,y),Ue(s.underStickers[U].buffer,z,y),Le(y)),pe(g.positionBuffer,z,y),Ue(R[U].buffer,z,y),Le(y)}Ct(s,l,o,R)}requestAnimationFrame(Qe)}function Mt(r){return v.animateTurns&&r.animationQueue[0]?r.animationQueue[0].stickers:r.stickers}function Ct(r,t,e,s){if(!!v.hintStickers){y.uniformMatrix4fv(z.uniformLocations.transformMatrix,!1,e);for(let n=2*r.layersSq;n<r.numOfStickers;n++){let i=t[n];pe(i.hintPositionBuffer,z,y),Ue(s[n].buffer,z,y),Le(y)}}}function Ve(){let r=document.querySelector(".slideRight"),t=!1;function e(s){if(t=s,t){r.classList.add("slideRightOpen");return}r.classList.remove("slideRightOpen")}document.addEventListener("click",s=>{let n=s.target;if(n===document.querySelector("#menu")){e(!0);return}t&&!n.closest(".slideRight")&&e(!1)}),document.querySelector("#closeMenu").addEventListener("click",()=>{e(!1)}),document.querySelector("#learnButton").addEventListener("click",()=>{document.location.href="learn.html"}),document.querySelector("#playButton").addEventListener("click",()=>{document.location.href="play.html"}),document.querySelector("#trainButton").addEventListener("click",()=>{document.location.href="train.html"}),document.querySelector("#cubleButton").addEventListener("click",()=>{document.location.href="cuble.html"})}var Se=!1;function ge(r){Se=!0,r.style.display="flex",r.classList.add("slideLeftOpen"),document.documentElement.clientWidth<725?r.classList.add("slideLeftClosed"):r.classList.remove("slideLeftClosed")}function ae(r){Se=!1,document.documentElement.clientWidth<725?(r.classList.add("slideLeftClosed"),r.classList.remove("slideLeftOpen"),r.style.display="flex"):r.style.display="none"}function Xe(r){Se?ae(r):ge(r)}var xe=[4,13,22,31,40,49],_t=[0,29,36],Pt=[6,35,51],X=[2,9,42],qt=[8,15,45],Ht=[18,11,44],wt=[24,47,17],zt=[20,38,27],Wt=[26,33,53],Kt=[3,32],Nt=[1,39],jt=[7,48],Gt=[5,12],Fe=[10,43],le=[16,46],Yt=[21,14],Qt=[19,41],Vt=[25,50],Xt=[23,30],$t=[28,37],Jt=[34,52],be=[..._t,...Pt,...X,...qt],De=[...Ht,...wt,...zt,...Wt],ke=[...Kt,...Nt,...jt,...Gt],ve=[...Fe,...le,...$t,...Jt],$=[...Yt,...Qt,...Vt,...Xt],F=[...xe,...ke],Z=[...F,...be],ee=[...Z,...ve],Zt=[...$,...De],W=[...ee,...Zt];function Be(r){return(r||"").split(" ")}function tr(){Ve();let r=[{setup:"",algorithm:"x x x x y y y y",activeStickers:xe,move:0},{setup:"",algorithm:"x x x x y y y y",activeStickers:[...be,...De],move:0},{setup:"",algorithm:"x x x x y y y y",activeStickers:[...ke,...ve,...$],move:0},{setup:"D D R R D' F F L L R R U B B F F U' R R U' L F' D L D D F' U U L B' U U L' U U L F'",algorithm:"y y y y",activeStickers:F,move:0},{setup:"D D R R D' F F L L R R U B B F F U' R R U' L F' D L D D F' U U L B' U U L' U U L F D y x",algorithm:"x' y' D' F F",activeStickers:F,move:0},{setup:"D D R R D' F F L L R R U B B F F U' R R U' L F' D L D D F' U U L B' U U L' U U L R' D' R F'",algorithm:"R' D' R F F",activeStickers:F,move:0},{setup:"D D R R D' F F L L R R U B B F F U' R R U' L F' D L D D F' U U L B' U U L' U U L R' D' R F' F'",algorithm:"F",activeStickers:F,move:0},{setup:"D D R R D' F F L L R R U B B F F U' R R U' L F' D L D D F' U U L B' U U L' U U L R' D' R",algorithm:"F'",activeStickers:F,move:0},{setup:"D D R R D' F F L L R R U B B F F U' R R U' L F' D L D D F' U U L B' U U L' U U L F' z z",algorithm:"U'",activeStickers:[...F,...X],move:0},{setup:"D D R R D' F F L L R R U B B F F U' R R U' L F' D L D D F' U U L B' U U L' U U L F' z z L' U U L",algorithm:"R U R' U'",activeStickers:[...F,...X],move:0},{setup:"D D R R D' F F L L R R U B B F F U' R R U' L F' D L D D F' U U L B' U U L' U U L F' z z U'",algorithm:"R U R' U' R U R' U' R U R' U' R U R' U' R U R' U'",activeStickers:[...F,...X],move:0},{setup:"D D R R D' F F L L R R U B B F F U' R R U' L F' D L D D F' U U L B' U U L' U U L F' z z U' R U R' U' R U R' U' R U R' U'",algorithm:"R U R' U' R U R' U'",activeStickers:[...F,...X],move:0},{setup:"D D R R D' F F L L R R U B B F F U' R R U' L F' D L D D F' U U L B' U U L' U U L F' z z R U' R' R' U U R B' U' B L' U' L U L' U' L",algorithm:"U",activeStickers:[...Z,...le],move:0},{setup:"D D R R D' F F L L R R U B B F F U' R R U' L F' D L D D F' U U L B' U U L' U U L F' z z R U' R' R' U U R B' U' B L' U' L U L' U' L U",algorithm:"U' L' U L y' U R U' R'",activeStickers:[...Z,...le],move:0},{setup:"D D R R D' F F L L R R U B B F F U' R R U' L F' D L D D F' U U L B' U U L' U U L F' z z R U' R' R' U U R B' U' B F U' F' U F U' F'",algorithm:"U R U' R' y U' L' U L",activeStickers:[...Z,...Fe],move:0},{setup:"z z R' L L F F L L F' L L F' L L F' R U F R U' R' F'",algorithm:"F R U R' U' F'",activeStickers:[...ee,...$],move:0},{setup:"z z L L F D D B' R R B D D B' F' U U R' U R U B U L L U",algorithm:"F U R U' R' F'",activeStickers:[...ee,...$],move:0},{setup:"z z B' L L F' D F' D R F' D D L L B' R R U U L L D D F F L L",algorithm:"F R U R' U' F' U U F U R U' R' F'",activeStickers:[...ee,...$],move:0},{setup:"z z R U R' U' D R R U' R U' R' U R' U R R D' R U U R' U' R U' R'",algorithm:"R U R' U R U U R'",activeStickers:W,move:0},{setup:"z z R U R' U' D R R U' R U' R' U R' U R R D' R U R' U R U U R' U U",algorithm:"R U R' U R U U R' U U R U R' U R U U R'",activeStickers:W,move:0},{setup:"z z R U R' U' D R R U' R U' R' U R' U R R D' F R' F' L F R F' L'",algorithm:"R U R' U R U U R' U R U R' U R U U R' U U R U R' U R U U R'",activeStickers:W,move:0},{setup:"z z R U R' U' D R R U' R U' R' U R' U R R D' U'",algorithm:"U R U R' F' R U R' U' R' F R R U' R'",activeStickers:W,move:0},{setup:"z z F R U' R' U' R U R' F' R U R' U' R' F R F'",algorithm:"R U R' F' R U R' U' R' F R R U' R'",activeStickers:W,move:0},{setup:"z z M M U' M' U U M U' M M",algorithm:"U U U U M' M' U M' U U M U M' M'",activeStickers:W,move:0},{setup:"z z M M U M M U U M M U M M",algorithm:"U U U U M' M' U M' U U M U M' M'",activeStickers:W,move:0}];function t(n){let i=Ye(`#scene${n}`);oe.push(i),r[n].cube=i.cube;let l=r[n],o=Array(54);l.activeStickers.forEach(c=>{o[c]=J(Y(c,i.cube))});for(let c=0;c<54;c++)o[c]||(o[c]=Ee(Y(c,i.cube)));i.cube.setColors(o),s(n);let a=l.setup;i.cube.execAlg(a)}let e=document.querySelector("#lessonNavigator");e.addEventListener("click",n=>{let i=n.target;if(i.className==="lesson-p"){let l=parseInt(i.getAttribute("lesson-index"));t(l),document.documentElement.clientWidth<725&&ae(e)}});function s(n){let i=r[n],l=document.querySelector(`#moveCounter${n}`),o=Be(i.algorithm);l.textContent=`${i.move} / ${o.length}`}for(let n=0;n<r.length;n++)t(n);v.dragEnabled=!1,Ge(),document.addEventListener("click",n=>{let i=n.target;if(i.id.startsWith("leftButton")){let l=parseInt(i.id.substring(10)),o=r[l];if(o.move<=0)return;o.move--;let a=Be(o.algorithm);o.cube.stepAlgorithm(a[o.move],!1),s(l)}else if(i.id.startsWith("rightButton")){let l=parseInt(i.id.substring(11)),o=r[l],a=Be(o.algorithm);if(o.move>=a.length)return;o.cube.stepAlgorithm(a[o.move],!0),o.move++,s(l)}}),document.querySelector("#openClose").addEventListener("click",n=>{Xe(e)}),Je()}window.addEventListener("resize",()=>{Je()});function Je(){let r=document.querySelector("#openClose"),t=document.querySelector("#lessonNavigator");if(document.documentElement.clientWidth<725){r.style.display="inline-block",ae(t);return}r.style.display="none",ge(t)}tr();})();
//# sourceMappingURL=learn.js.map
